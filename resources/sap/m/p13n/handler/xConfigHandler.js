/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine"],function(e){"use strict";var t={};var n=function(e,t){var n=function(t){if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};function a(t,n){if(t.isA){e.getInstance().trace(t,{selectorElement:t,changeSpecificData:{changeType:n.getChangeType(),content:n.getContent()}});if(!t._pPendingModification){t._pPendingModification=e.getInstance().waitForChanges(t).then(function(){e.getInstance().fireStateChange(t);e.getInstance().clearTrace(t);delete t._pPendingModification})}}}t.createHandler=function(t){if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var g=t.property;var r;return{changeHandler:{applyChange:function(o,i,p){return n(i,function(){return e.getInstance().readXConfig(i,{propertyBag:p}).then(function(n){var a=o.getChangeType().indexOf("add")>-1?"add":"remove";a=o.getChangeType().indexOf("move")===0?"move":a;r=o.getContent().targetAggregation;var c={key:o.getContent().key};c.value=a!=="add";var u;if(a==="move"){u=e.getInstance().getController(i,o.getChangeType()).getCurrentState();var f=u.find(function(e,t){if(e.key===o.getContent().key){return e}});c.targetAggregation=o.getContent().targetAggregation;c.index=u.indexOf(f)}if(n&&n.aggregations&&n.aggregations[r]&&n.aggregations[r][o.getContent().key]&&n.aggregations[r][o.getContent().key][g]){c.value=n.aggregations[r][o.getContent().key][g]}o.setRevertData(c);var d={property:g,key:o.getContent().key,value:o.getContent(),operation:a,changeType:o.getChangeType(),propertyBag:p};if(t.aggregationBased){d.controlMeta={aggregation:r}}return e.getInstance().enhanceXConfig(i,d)}).then(function(){a(i,o)})})},completeChangeContent:function(e,t,n){},revertChange:function(n,o,i){var p=n.getChangeType().indexOf("add")>-1?"remove":"add";p=n.getChangeType().indexOf("move")===0?"move":p;r=n.getContent().targetAggregation;var c={controlMeta:{aggregation:r,property:g},property:g,operation:p,changeType:n.getChangeType(),key:n.getRevertData().key,value:n.getRevertData(),propertyBag:i};if(t.aggregationBased){c.controlMeta={aggregation:r}}return e.getInstance().enhanceXConfig(o,c).then(function(){n.resetRevertData();a(o,n)})}},layers:{USER:true}}};return t});
//# sourceMappingURL=xConfigHandler.js.map