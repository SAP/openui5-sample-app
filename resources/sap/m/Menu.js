/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/library","sap/ui/core/library","sap/ui/core/Control","sap/m/ResponsivePopover","sap/m/Button","sap/m/Bar","sap/m/Title","sap/m/MenuItem","sap/m/MenuWrapper","sap/ui/core/Lib","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/EnabledPropagator","sap/base/i18n/Localization","sap/base/Log"],function(e,t,o,n,s,r,i,p,u,a,l,c,h,m,g){"use strict";const f=e.PlacementType;const d=t.ItemSelectionMode;const _=o.extend("sap.m.Menu",{metadata:{interfaces:["sap.ui.core.IContextMenu"],library:"sap.m",properties:{title:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.IMenuItem",multiple:true,singularName:"item",bindable:"bindable",defaultClass:p,forwarding:{idSuffix:"-menuWrapper",aggregation:"items"}},_menuWrapper:{type:"sap.m.MenuWrapper",multiple:false,visibility:"hidden"},_popover:{type:"sap.m.ResponsivePopover",multiple:false,visibility:"hidden"}},events:{itemSelected:{parameters:{item:{type:"sap.m.IMenuItem"}}},closed:{},beforeClose:{allowPreventDefault:true,parameters:{item:{type:"sap.m.IMenuItem"}}}}},renderer:null});h.call(_.prototype);_.prototype.init=function(){const e=this._createMenuWrapper(),t=this._createPopover();e.attachClosePopover(this.close,this);e.attachCloseItemSubmenu(this._collectSubmenusToClose,this);e.attachItemSelected(this._handleItemSelected,this);t.attachAfterClose(this._menuClosed,this);this._aSubmenusToClose=[];this._openDuration=l.system.phone?null:0};_.prototype.exit=function(){const e=this._getMenuWrapper(),t=this._getPopover();e.detachClosePopover(this.close,this);e.detachCloseItemSubmenu(this._collectSubmenusToClose,this);e.detachItemSelected(this._handleItemSelected,this);t.detachAfterClose(this._menuClosed,this);e.destroy();t.destroy()};_.prototype.setTitle=function(e){const t=this._getPopover(),o=this._getMenuWrapper(),n=t.getCustomHeader();if(n){o.setTitle(e);n.getContentMiddle()[0].setText(e)}this.setProperty("title",e,true);return this};_.prototype.openBy=function(e){const t=this._getPopover();if(!e){e=document.body}t._getPopup().setDurations(this._openDuration,0);t.openBy(e);return this};_.prototype.close=function(e){const t=e?e.getParameters():{},o={},n=this._getPopover();if(t["origin"]){o["item"]=t["origin"]}this._refreshSubmenusToClose();if(n&&this.fireBeforeClose(o)){this._closeSubmenuPopovers();n._getPopup().setDurations(this._openDuration,0);n.close()}return this};_.prototype._handleItemSelected=function(e){e.cancelBubble();this.fireItemSelected({item:e.getParameter("item")})};_.prototype._refreshSubmenusToClose=function(){this._aSubmenusToClose=this._aSubmenusToClose.filter(e=>e._getPopover().isOpen())};_.prototype._closeSubmenuPopovers=function(){while(this._aSubmenusToClose.length){this._aSubmenusToClose.pop()._closeSubmenu()}};_.prototype.isOpen=function(){return this._getPopover().isOpen()};_.prototype.getDomRefId=function(){const e=this._getPopover().getDomRef();return e?e.id:""};_.prototype.openAsContextMenu=function(e,t){const o=this._getPopover(),n=e&&e.pageX!==undefined&&e.pageY!==undefined,s=!n&&!t&&e.offsetX!==undefined&&e.offsetY!==undefined,r=e&&e.originalEvent;let i=t&&t.getDomRef?t.getDomRef():t,p=document.getElementById("sapMMenuContextMenuPointer"),u=document.body,a=null,c=0,h=0;o._getPopup().setDurations(this._openDuration,0);if(o.isOpen()){o.close()}if(l.system.phone){o.openBy();return}if(!t&&!s){i=e.srcControl?e.srcControl.getDomRef():null;if(!i){i=r&&r.currentTarget?r.currentTarget:null}}if(p){p.remove()}p=document.createElement("div");p.id="sapMMenuContextMenuPointer";p.className="sapMMenuContextMenuPointer";const g=i?i.getBoundingClientRect():null;if(r&&n){const e=r.pageX||r.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft);const t=r.pageY||r.clientY+(document.documentElement.scrollTop||document.body.scrollTop);if(i.tagName.toLowerCase()==="tr"){u=i.firstChild?i.firstChild:i;a=u.firstChild?u.firstChild:null}else{u=i;a=i.firstChild?i.firstChild:null}c=e-g.left-window.scrollX;h=t-g.top-window.scrollY;if(m.getRTL()){c=document.body.clientWidth-c}}else if(s){c=e.offsetX;h=e.offsetY}u.insertBefore(p,a);p.style.insetInlineStart=`${c}px`;p.style.insetBlockStart=`${h}px`;p.setAttribute("aria-hidden","true");o.openBy(p);o.attachAfterClose(this._onContextMenuClose,this)};_.prototype._onContextMenuClose=function(){const e=document.getElementById("sapMMenuContextMenuPointer"),t=this._getPopover();e&&e.remove();t.detachAfterClose(this._onContextMenuClose,this)};["addStyleClass","removeStyleClass","toggleStyleClass"].forEach(function(e){_.prototype[e]=function(t,n){const s=this._getPopover();this._getMenuWrapper()._processStyleClasses(t,e);o.prototype[e].apply(this,arguments);if(e!=="toggleStyleClass"&&s){s[e].apply(s,arguments)}return this}});_.prototype.getSelectedItems=function(){return this._getItems().filter(e=>e.getSelected&&e.getSelected()&&e._getItemSelectionMode()!==d.None)};_.prototype._collectSubmenusToClose=function(e){const t=e.getParameter("item");this._refreshSubmenusToClose();if(this._aSubmenusToClose.indexOf(t)===-1){this._aSubmenusToClose.push(t)}};_.prototype._setCustomEnhanceAccStateFunction=function(e){this._fnEnhanceUnifiedMenuAccState=e};_.prototype._menuClosed=function(e){const t=e&&e.getParameter("openBy");this.fireClosed();if(t){try{t.focus()}catch(e){g.warning("Menu.close cannot restore the focus on opener "+t+", "+e)}}};_.prototype._isMenuItemGroup=function(e){return!!e.getItemSelectionMode};_.prototype._getItems=function(){const e=[];const t=o=>{o.forEach(o=>{if(!this._isMenuItemGroup(o)){e.push(o)}else{t(o.getItems())}})};t(this.getItems());return e};_.prototype._createMenuWrapper=function(e){const t=new u(this.getId()+"-menuWrapper",{isSubmenu:e});this.setAggregation("_menuWrapper",t,true);return t};_.prototype._createPopover=function(){let e=this._getPopover();if(e){return e}const t=l.system.phone?`${this.getId()}-title`:c.getStaticId("sap.m","MENU_POPOVER_ACCESSIBLE_NAME");const o=this._getMenuWrapper(),s=m.getRTL(),r=o.getIsSubmenu(),i=s?4:-4;e=new n(this.getId()+"-rp",{placement:this._getPopoverPlacement(),showHeader:false,showArrow:false,showCloseButton:false,verticalScrolling:true,horizontalScrolling:false,offsetX:r?i:1,offsetY:r?4:1,content:o,ariaLabelledBy:[t]});e.addStyleClass("sapMMenu");this.setAggregation("_popover",e,true);if(l.system.phone){e.setShowHeader(true);e.setEndButton(this._createCloseButton());e.setCustomHeader(this._createHeaderBar())}else if(r){e.getAggregation("_popup")._adaptPositionParams=function(){this._marginTop=0;this._marginLeft=0;this._marginRight=0;this._marginBottom=0;this._arrowOffset=0;this._offsets=["0 0","0 0","0 0","0 0"];this._myPositions=["begin bottom","begin top","begin top","end top"];this._atPositions=["begin top","end top","begin bottom","begin top"]}}e._oControl._getDocHeight=()=>window.innerHeight+window.scrollY;return e};_.prototype._createBackButton=function(){return new s(this.getId()+"-backbutton",{icon:"sap-icon://nav-back",press:e=>{this._getMenuWrapper().fireClosePopover()}})};_.prototype._createHeaderBar=function(){const e=this._getMenuWrapper(),t=new r({contentMiddle:new i(this.getId()+"-title",{text:e.getTitle()})}),o=this._getMenuWrapper().getIsSubmenu();if(o){t.addContentLeft(this._createBackButton())}return t};_.prototype._createCloseButton=function(){const e=a.getResourceBundleFor("sap.m");return new s({text:e.getText("MENU_CLOSE"),press:()=>{this._getMenuWrapper().fireClosePopover({bubbleToRoot:true})}})};_.prototype._getMenuWrapper=function(){const e=this._getPopover();return e?e.getContent()[0]:this.getAggregation("_menuWrapper")};_.prototype._getPopover=function(){return this.getAggregation("_popover")};_.prototype._getPopoverPlacement=function(){const e=this._getMenuWrapper().getIsSubmenu();if(e){const e=m.getRTL(),t=e?f.HorizontalPreferredLeft:f.HorizontalPreferredRight;return t}return f.VerticalPreferredBottom};_.prototype._setExtraContent=function(e){this._getPopover()._getPopup().setExtraContent([e])};return _});
//# sourceMappingURL=Menu.js.map