/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TimePickerInternals","./TimePickerClock","./ToggleButton","./SegmentedButton","./SegmentedButtonItem","./TimePickerClocksRenderer","./ToggleButtonRenderer","sap/ui/core/Renderer","sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/library","sap/ui/thirdparty/jquery","sap/ui/core/date/UI5Date"],function(t,e,s,i,o,n,l,a,r,c,u,jQuery,h){"use strict";var d=1e3;var g=u.TextDirection;var _=t.extend("sap.m.TimePickerClocks",{metadata:{aggregations:{_buttons:{type:"sap.m.internal.ToggleSpinButton",multiple:true,visibility:"hidden"},_clocks:{type:"sap.m.TimePickerClock",multiple:true,visibility:"hidden"}}},renderer:n});var p=a.extend(l);p.apiVersion=2;p.render=function(t,e){var s=e.getId(),i=e.getType(),o=e.getEnabled(),n=e.getWidth(),l=e._getTooltip(),a=e._getText(),r=e.getTextDirection(),u=c.browser.internet_explorer||c.browser.edge,h=r===g.Inherit&&!u;t.openStart("div",e);t.class("sapMBtnBase");t.class("sapMBtn");var d=this.generateAccProps(e);d["pressed"]=null;d["valuemin"]=e.getMin();d["valuemax"]=e.getMax();d["valuenow"]=parseInt(e.getText());d["label"]=l;d["valuetext"]=parseInt(e.getText()).toString()+" "+l;d["role"]="spinbutton";t.accessibilityState(e,d);if(!o){t.attr("disabled","disabled");t.class("sapMBtnDisabled")}if(n!=""||n.toLowerCase()==="auto"){t.style("width",n);t.style("min-width","2.25rem")}if(l){t.attr("title",l)}t.attr("tabindex","0");t.openEnd();t.openStart("span",s+"-inner");t.class("sapMBtnInner");if(e._isHoverable()){t.class("sapMBtnHoverable")}if(o){t.class("sapMFocusable");if(u){t.class("sapMIE")}}if(a){t.class("sapMBtnText")}if(e.getPressed()){t.class("sapMToggleBtnPressed")}if(i!==""){t.class("sapMBtn"+i)}t.openEnd();if(a){t.openStart("span",s+"-content");t.class("sapMBtnContent");if(r!==g.Inherit){t.attr("dir",r.toLowerCase())}t.openEnd();if(h){t.openStart("bdi",s+"-BDI-content");t.openEnd()}t.text(a);if(h){t.close("bdi")}t.close("span")}if(u&&o){t.openStart("span");t.class("sapMBtnFocusDiv");t.openEnd();t.close("span")}t.close("span");if(l){t.openStart("span",s+"-tooltip");t.class("sapUiInvisibleText");t.openEnd();t.text(l);t.close("span")}t.close("div")};var f=s.extend("sap.m.internal.ToggleSpinButton",{metadata:{library:"sap.m",properties:{label:{type:"string",defaultValue:""},min:{type:"int",defaultValue:0},max:{type:"int",defaultValue:0}}},renderer:p});_.prototype.init=function(){t.prototype.init.apply(this,arguments);this._activeClock=0};_.prototype.onAfterRendering=function(){if(!this._clickAttached){this._attachClickEvent()}this._clockConstraints=this._getClocksConstraints()};_.prototype.onkeyup=function(t){var e=t.which||t.keyCode;if(e===r.CONTROL){t.preventDefault();if(this._clockIndexes.H===this._getActiveClockIndex()&&this.getSupport2400()&&this._ctrlKeyDown===1){this._getActiveClock()._toggle2400(true)._markToggleAsSelected(false)}this._ctrlKeyDown=0}else if(e===r.SPACE){this._spaceKeyDown=false}};_.prototype.onkeydown=function(t){var e=t.which||t.keyCode,s=t.key,i=this.getAggregation("_clocks"),o=this._getActiveClock(),n=this._getActiveClockIndex(),l=this.getSupport2400(),a=["0","1","2","3","4","5","6","7","8","9",":"],c,u,h,d="",g,_,p,f=0,k=-1,C=t.srcControl&&t.srcControl.getMetadata().getName().indexOf("ToggleSpinButton")===-1?false:true;if(this._clockIndexes.H===n&&l&&e===r.CONTROL&&!this._ctrlKeyDown){t.preventDefault();this._ctrlKeyDown=1;o._toggle2400(true)._markToggleAsSelected(true)}else if(e===r.ENTER){if(!C){return}if(typeof this._parentAcceptCallback==="function"){this._parentAcceptCallback()}}else if((e===r.ARROW_UP||e===r.ARROW_DOWN)&&!t.altKey&&!t.metaKey){o&&o.getEnabled()&&o.modifyValue(e===r.ARROW_UP);t.preventDefault()}else if((e===r.PAGE_UP||e===r.PAGE_DOWN)&&!t.altKey&&!t.metaKey){t.preventDefault();if(!t.shiftKey&&!t.ctrlKey){o=this._getHoursClock()}else if(t.shiftKey&&!t.ctrlKey){o=this._getMinutesClock()}else{o=this._getSecondsClock()}o&&o.getEnabled()&&o.modifyValue(e===r.PAGE_UP);o&&this._switchClock(this._getClockIndex(o))}else if(e===r.P||e===r.A){t.preventDefault();c=this._getFormatButton();c&&c.setSelectedKey(e===r.P?"pm":"am")}else if(e===r.SPACE&&!this._spaceKeyDown){if(!C){return}t.preventDefault();this._spaceKeyDown=true;h=o.getSelectedValue();u=o._get24HoursVisible()?24:0;if(this._clockIndexes.H===n&&l&&h!==u&&(h===24||h===0)){o.setSelectedValue(u)}this._kbdBuffer="";this._resetCooldown(true);setTimeout(function(){this._switchNextClock(true)}.bind(this),0)}else if(a.indexOf(s)!==-1){this._exactMatch=null;this._resetCooldown(true);if(s===":"){this._kbdBuffer="";this._resetCooldown(true);this._switchNextClock(true)}else if(this._clockConstraints[n]){d=this._kbdBuffer+s;g=parseInt(d);if(this._clockConstraints[n].step===1){if(g>this._clockConstraints[n].max){i[n].setSelectedValue(parseInt(this._kbdBuffer));this._switchNextClock();this._kbdBuffer=s;n=this._getActiveClockIndex();i[n].setSelectedValue(parseInt(s));this._resetCooldown(true)}else{this._kbdBuffer=d;i[n].setSelectedValue(parseInt(this._kbdBuffer));if(this._kbdBuffer.length===2||parseInt(this._kbdBuffer+"0")>this._clockConstraints[n].max){this._resetCooldown(this._kbdBuffer.length===2?false:true);this._kbdBuffer="";this._switchNextClock()}}}else{for(_=this._clockConstraints[n].min;_<=this._clockConstraints[n].max;_++){if(_%this._clockConstraints[n].step===0){p=_.toString();if(d===p.substr(0,d.length)||g===_){f++;k=f===1?_:-1;if(g===_){this._exactMatch=_}}}}if(f===1){i[n].setSelectedValue(k);this._exactMatch=null;this._kbdBuffer="";this._resetCooldown(true);this._switchNextClock()}else if(d.length===2){this._exactMatch=null;this._kbdBuffer="";this._resetCooldown(true)}else{this._kbdBuffer=d}}}}};_.prototype.setValue=function(e){var s=this._getHoursClock(),i=this._getValueFormatPattern(),o=i.indexOf("HH"),n=i.indexOf("H"),l=s&&s.getSelectedValue()===24,a=t._isHoursValue24(e,o,n),r;if(l&&this._isFormatSupport24()&&!a){e=t._replaceZeroHoursWith24(e,o,n)}e=this.validateProperty("value",e);this.setProperty("value",e,true);if(e){r=this._parseValue(a?t._replace24HoursWithZero(e,o,n):e)}if(r){this._setTimeValues(r,a)}return this};_.prototype.getTimeValues=function(){var t=this._getHoursClock(),e=this._getMinutesClock(),s=this._getSecondsClock(),i=this._getFormatButton(),o=null,n=null,l=h.getInstance();if(t){o=parseInt(t.getSelectedValue())}if(i){n=i.getSelectedKey()}if(n==="am"&&o===12){o=0}else if(n==="pm"&&o!==12){o+=12}if(o!==null){l.setHours(o.toString())}if(e){l.setMinutes(e.getSelectedValue())}if(s){l.setSeconds(s.getSelectedValue())}return l};_.prototype.showFirstClock=function(){this._switchClock(0);return this};_.prototype._attachClickEvent=function(){var t=this.getDomRef();t.addEventListener("click",jQuery.proxy(this._focusActiveButton,this),false);this._clickAttached=true};_.prototype._focusActiveButton=function(){var t=this.getAggregation("_buttons"),e=this._getActiveClockIndex();t&&t[e]&&t[e].focus()};_.prototype._setAcceptCallback=function(t){this._parentAcceptCallback=t};_.prototype._resetCooldown=function(t){if(d===0){return}if(this._typeCooldownId){clearTimeout(this._typeCooldownId)}if(t){this._startCooldown()}};_.prototype._startCooldown=function(){if(d===0){return}this._typeCooldownId=setTimeout(function(){this._kbdBuffer="";this._typeCooldownId=null;if(this._exactMatch){this._getActiveClock().setSelectedValue(this._exactMatch);this._exactMatch=null}}.bind(this),d)};_.prototype._switchNextClock=function(t){var e=this._getActiveClockIndex(),s=this.getAggregation("_clocks"),i=s.length,o=this._getActiveClock(),n=e;if(!s){return}if(this._clockIndexes.H===e&&this.getSupport2400()){o._save2400State();if(o.getSelectedValue()===24){return}}do{e++;if(e>=i){e=t?0:i-1}}while(!o.getEnabled()&&e!==n&&(t||e<i-1));this._ctrlKeyDown=0;if(e!==n&&s[e].getEnabled()){this._switchClock(e)}};_.prototype._getClocksConstraints=function(){var t=this.getAggregation("_clocks"),e=this.getSupport2400(),s=[],i,o,n,l,a;if(t){for(a=0;a<t.length;a++){i=t[a].getItemMin();o=t[a]._getMaxValue();n=t[a].getValueStep();l=t[a].getLastItemReplacement();if(l!==-1&&l<i){i=l;if(o!==24||!e){o--}}else if(o===24&&e){i=0}s[a]={min:i,max:o,step:n,prependZero:t[a].getPrependZero()}}}return s};_.prototype._getActiveClockIndex=function(){return this._activeClock||0};_.prototype._getActiveClock=function(){var t=this._getActiveClockIndex(),e=this.getAggregation("_clocks");return e&&e[t]?e[t]:null};_.prototype._setTimeValues=function(t,e){var s=this._getHoursClock(),i=this._getMinutesClock(),o=this._getSecondsClock(),n=this._getMinutesButton(),l=this._getSecondsButton(),a=this._getFormatButton(),r=this.getValueFormat(),c,u=null,d=!this._isFormatSupport24()&&r.indexOf("B")!==-1,g=r.indexOf("a")!==-1||r==="";t=t||h.getInstance();if(Object.prototype.toString.call(t)!=="[object Date]"||isNaN(t)){throw new Error("Date must be a JavaScript or UI5Date date object; "+this)}if(!e){var _=this._formatValue(t,true);this.setProperty("value",_,true);c=t.getHours()}else{c=24}if((g||d)&&a){u=c>=12?"pm":"am";c=c>12?c-12:c;c=c===0?12:c;a&&a.setSelectedKey(u)}s&&s.setSelectedValue(c);i&&i.setSelectedValue(t.getMinutes());o&&o.setSelectedValue(t.getSeconds());s&&this.getSupport2400()&&s._save2400State();if(e){i&&i.setSelectedValue(0).setEnabled(false);o&&o.setSelectedValue(0).setEnabled(false);n&&n.setEnabled(false);l&&l.setEnabled(false)}else{i&&i.setEnabled(true);o&&o.setEnabled(true);n&&n.setEnabled(true);l&&l.setEnabled(true)}};_.prototype._getHoursClock=function(){var t=this.getAggregation("_clocks");return t&&this._clockIndexes&&t[this._clockIndexes.H]?t[this._clockIndexes.H]:null};_.prototype._getMinutesClock=function(){var t=this.getAggregation("_clocks");return t&&this._clockIndexes&&t[this._clockIndexes.M]?t[this._clockIndexes.M]:null};_.prototype._getSecondsClock=function(){var t=this.getAggregation("_clocks");return t&&this._clockIndexes&&t[this._clockIndexes.S]?t[this._clockIndexes.S]:null};_.prototype._getHoursButton=function(){var t=this.getAggregation("_buttons");return t&&this._clockIndexes&&t[this._clockIndexes.H]?t[this._clockIndexes.H]:null};_.prototype._getMinutesButton=function(){var t=this.getAggregation("_buttons");return t&&this._clockIndexes&&t[this._clockIndexes.M]?t[this._clockIndexes.M]:null};_.prototype._getSecondsButton=function(){var t=this.getAggregation("_buttons");return t&&this._clockIndexes&&t[this._clockIndexes.S]?t[this._clockIndexes.S]:null};_.prototype._destroyControls=function(){this.destroyAggregation("_buttons");this.destroyAggregation("_clocks");this.destroyAggregation("_buttonAmPm")};_.prototype._createControls=function(){var s=this._getDisplayFormatPattern(),n=this.getId(),l=this._isFormatSupport24(),a=this.getSupport2400(),r=0,c=0,u=0,h="",d=-1,g,_,p,k,C,m=0,x,b,y,S=false,v,I,A={hours:this._oResourceBundle.getText("TIMEPICKER_LBL_HOURS"),minutes:this._oResourceBundle.getText("TIMEPICKER_LBL_MINUTES"),seconds:this._oResourceBundle.getText("TIMEPICKER_LBL_SECONDS"),ampm:this._oResourceBundle.getText("TIMEPICKER_AMPM_BUTTON_TOOLTIP")};this._clockIndexes={};if(s===undefined){return}g=s.indexOf("HH");_=s.indexOf("H");if(g!==-1){x=true;S=true;d=a?24:0;b=0;y=23}else if(_!==-1){x=true;d=a?24:0;b=0;y=23}else if(s.indexOf("hh")!==-1){x=true;S=true;b=1;y=12}else if(s.indexOf("h")!==-1){x=true;b=1;y=12}if(x){this.addAggregation("_clocks",new e(n+"-clockH",{label:A["hours"],selectedValue:r,itemMin:1,itemMax:12,valueStep:1,displayStep:1,innerItems:l,lastItemReplacement:d,prependZero:S,support2400:a}));if(a){y++}this.addAggregation("_buttons",new f(n+"-btnH",{tooltip:A["hours"],min:b,max:y}));this._clockIndexes.H=m++}if(s.indexOf("m")!==-1){if(s.indexOf("mm")!==-1){d=0;S=true}else{d=0;S=false}this.addAggregation("_clocks",new e(n+"-clockM",{label:A["minutes"],selectedValue:c,itemMin:1,itemMax:60,valueStep:this.getMinutesStep(),lastItemReplacement:d,prependZero:S}));this.addAggregation("_buttons",new f(n+"-btnM",{tooltip:A["minutes"],min:0,max:59}));this._clockIndexes.M=m++}if(s.indexOf("s")!==-1){if(s.indexOf("ss")!==-1){d=0;S=true}else{d=0;S=false}this.addAggregation("_clocks",new e(n+"-clockS",{label:A["seconds"],selectedValue:u,itemMin:1,itemMax:60,valueStep:this.getSecondsStep(),lastItemReplacement:d,prependZero:S}));this.addAggregation("_buttons",new f(n+"-btnS",{tooltip:A["seconds"],min:0,max:59}));this._clockIndexes.S=m++}if(s.indexOf("a")!==-1||s.indexOf("B")!==-1&&!this._isFormatSupport24()){this.setAggregation("_buttonAmPm",new i(n+"-format",{items:[new o({text:this._sAM,key:"am"}),new o({text:this._sPM,key:"pm"})],selectedKey:h,tooltip:A["ampm"]}))}if(!this.getAggregation("_nowButton")){this.setAggregation("_nowButton",this._getCurrentTimeButton())}k=this.getAggregation("_buttons");C=this.getAggregation("_clocks");this._clockCount=C?C.length:0;if(this._clockCount){this._switchClock(0)}for(m=0;m<this._clockCount;m++){this._attachEvents(C[m],k[m])}v=this.getValue();if(v){p=t._isHoursValue24(v,g,_);I=this._parseValue(p?t._replace24HoursWithZero(v,g,_):v);if(I){this._setTimeValues(I,p)}}};_.prototype._attachEvents=function(t,e){t.attachChange(function(t){var e=t.getParameter("value"),s=t.getParameter("finalChange"),i=t.getParameter("stringValue"),o=this.getAggregation("_buttons"),n=t.getParameter("id").slice(-1);o[this._clockIndexes[n]]&&o[this._clockIndexes[n]].setText(i).focus();if(!s){if(n==="H"){this._handleHoursChange(t)}return}if(!this.getSupport2400()||e!==24){setTimeout(function(){this._switchNextClock()}.bind(this),0)}}.bind(this));e.attachPress(function(t){var e=t.getParameter("id").slice(-1),s=this.getAggregation("_clocks");if(s[this._clockIndexes[e]].getEnabled()){this._switchClock(this._clockIndexes[e])}}.bind(this));e.onfocusin=function(t){var e=t.target.id.slice(-1),s=this.getAggregation("_clocks");if(s[this._clockIndexes[e]].getEnabled()){this._switchClock(this._clockIndexes[e])}}.bind(this)};_.prototype._switchClock=function(t){var e=this.getAggregation("_clocks"),s=this.getAggregation("_buttons"),i=this._getActiveClock();if(t!==this._activeClock){i._save2400State()}if(this._activeClock!==undefined){s[this._activeClock].setPressed(false);e[this._activeClock].removeStyleClass("sapMTPCActive")}e[t].addStyleClass("sapMTPCActive");s[t].setPressed(true);s[t].focus();this._activeClock=t};_.prototype._getClockIndex=function(t){var e=t.getId().slice(-1);return this._clockIndexes[e]};_.prototype._handleHoursChange=function(t){var e=parseInt(t.getParameter("value")),s=this._getMinutesClock(),i=this._getSecondsClock(),o=this._getMinutesButton(),n=this._getSecondsButton();if(!this.getSupport2400()){return}this._ctrlKeyDown=this._ctrlKeyDown?2:0;if(e===24){if(s&&s.getEnabled()){this._sMinutes=s.getSelectedValue();this._setControlValueAndEnabled(s,o,0,false)}if(i&&i.getEnabled()){this._sSeconds=i.getSelectedValue();this._setControlValueAndEnabled(i,n,0,false)}}else{if(s&&!s.getEnabled()){this._setControlValueAndEnabled(s,o,this._sMinutes,true)}if(i&&!i.getEnabled()){this._setControlValueAndEnabled(i,n,parseInt(this._sSeconds),true)}}this._getHoursButton().focus()};_.prototype._setControlValueAndEnabled=function(t,e,s,i){t.setSelectedValue(parseInt(s));t.setEnabled(i);e.setEnabled(i)};_.prototype._formatNumberToString=function(t,e,s,i){var o;if(e&&t<10){o=t.toString().padStart(2,"0")}else if(t===s&&i!==""){o=i}else{o=t.toString()}return o};return _});
//# sourceMappingURL=TimePickerClocks.js.map