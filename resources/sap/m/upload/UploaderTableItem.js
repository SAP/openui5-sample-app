/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/m/library","sap/ui/core/Element","sap/ui/core/util/File","sap/ui/Device","sap/m/upload/UploaderHttpRequestMethod","sap/m/upload/UploadItem"],function(e,t,s,a,r,n,o){"use strict";var i=s.extend("sap.m.upload.UploaderTableItem",{metadata:{library:"sap.m",publicMethods:["uploadItem","downloadItem"],properties:{uploadUrl:{type:"string",defaultValue:null},downloadUrl:{type:"string",defaultValue:null},httpRequestMethod:{type:"sap.m.upload.UploaderHttpRequestMethod",defaultValue:n.Post},useMultipart:{type:"boolean",defaultValue:false}},events:{uploadStarted:{parameters:{item:{type:"any"}}},uploadProgressed:{parameters:{item:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},uploadCompleted:{parameters:{item:{type:"any"},responseXHR:{type:"object"}}}}}});i.prototype.init=function(){this._mRequestHandlers={}};i.uploadFile=function(e,t,s){var a=new window.XMLHttpRequest;var n=this.getHttpRequestMethod();return new Promise(function(o,i){a.open(n,t,true);if((r.browser.edge||r.browser.internet_explorer)&&e.type&&a.readyState===1){a.setRequestHeader("Content-Type",e.type)}if(s){s.forEach(function(e){a.setRequestHeader(e.getKey(),e.getText())})}a.onreadystatechange=function(){if(this.readyState===window.XMLHttpRequest.DONE){if(this.status===200){o(this)}else{i(this)}}};a.send(e)})};i.prototype.uploadItem=function(e,t){var s=new window.XMLHttpRequest,a=e.getFileObject(),n=this,o={xhr:s,item:e},i=this.getHttpRequestMethod(),p=e.getUploadUrl()||this.getUploadUrl();const d=()=>!window.navigator.onLine;const l=()=>{n.fireUploadCompleted({item:e,responseXHR:{response:null,responseXML:null,responseText:JSON.stringify({error:"Internet is offline. Please check your connection and try again."}),readyState:4,status:0,headers:""}})};s.open(i,p,true);if((r.browser.edge||r.browser.internet_explorer)&&a.type&&s.readyState===1){s.setRequestHeader("Content-Type",a.type)}if(t){t.forEach(function(e){s.setRequestHeader(e.getKey(),e.getText())})}s.onreadystatechange=function(){var t=n._mRequestHandlers[e.getId()],s={};if(this.readyState===window.XMLHttpRequest.DONE&&!t.aborted){s={response:this.response,responseXML:this.responseXML,responseText:this.responseText,readyState:this.readyState,status:this.status,headers:this.getAllResponseHeaders()};n.fireUploadCompleted({item:e,responseXHR:s})}};if(this.getUseMultipart()){var u=new window.FormData;var f=a?a.name:null;if(a instanceof window.Blob&&f){u.append(f,a,a.name)}else{u.append(f,a)}u.append("_charset_","UTF-8");a=u;this._mRequestHandlers[e.getId()]=o;if(d()){this.fireUploadStarted({item:e});l()}else{s.send(a);this.fireUploadStarted({item:e})}}else{this._mRequestHandlers[e.getId()]=o;if(d()){this.fireUploadStarted({item:e});l()}else{s.send(a);this.fireUploadStarted({item:e})}}};i.prototype.download=function(s,n,i){var p=this.getDownloadUrl()||s.getUrl();if(r.browser.name==="sf"){i=false}if(!s.getUrl()){e.warning("Items to download do not have a URL.");return false}else if(i){var d=null,l=new window.XMLHttpRequest;l.open("GET",p);n.forEach(function(e){l.setRequestHeader(e.getKey(),e.getText())});l.responseType="blob";l.onload=function(){let e=o;if(s instanceof o){e=o}var t=s.getFileName(),r=e._splitFileName(t,false);d=l.response;a.save(d,r.name,r.extension,s.getMediaType(),"utf-8")};l.send();return true}else{t.URLHelper.redirect(p,true);return true}};return i});
//# sourceMappingURL=UploaderTableItem.js.map