/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/upload/p13n/mediator/BaseMediator","sap/m/p13n/GroupPanel","sap/m/upload/p13n/modules/CustomDataConfig","sap/ui/core/Configuration","sap/base/util/deepEqual","sap/ui/model/Sorter"],function(e,t,r,o,n,a){"use strict";const i=e.extend("sap.m.upload.p13n.mediator.GroupMediator",{constructor:function(t){e.call(this,t)}});i.prototype.createPanel=function(){return Promise.resolve(this.createUi(this.getPanelData()))};i.prototype.createUi=function(e){this._oPanel=new t;this._oPanel.setP13nData(e);return this._oPanel};i.prototype.getPanelData=function(){const e=this.arrayToMap(this.getCurrentState(),true);const t=[],r=this.getControl()._getP13nMetadata();r[this.getP13nMetadataTarget()].forEach(r=>{t.push({name:r.key,label:r.label||r.key,tooltip:r.tooltip,index:e[r.key]?e[r.key].index:undefined,grouped:!!e[r.key]})});const n=o.getLocale().toString(),a=window.Intl.Collator(n,{});t.sort((e,t)=>{if(e.grouped&&t.sorted){return(e.index||0)-(t.index||0)}if(e.grouped){return-1}if(t.grouped){return 1}return a.compare(e.label,t.label)});t.forEach(e=>delete e.index);return t};i.prototype.getCurrentState=function(){const e=r.read(this.getControl())||{};const t=e.hasOwnProperty("properties")&&e.properties[this.getTargetAggregation()]?e.properties[this.getTargetAggregation()]:{};const o=Object.values(t).filter(e=>e.grouped).sort((e,t)=>e.index-t.index);return o.map(e=>({key:e.key}))};i.prototype.getChanges=function(){const e=[],t=this.getCurrentState(),r=this._getP13nData(),o=r.filter(e=>!!e.grouped).map(e=>({key:e.name}));if(n(t,o)){return e}const a=this._getDeletes(t,o),i=this._getInserts(t,o),s=this._getMove(t,o,a,i);e.push(this.createChange("uploadSetTableGroupStateChange",{deleted:a,moved:s,inserted:i}));return e};i.prototype._getP13nData=function(){return this._oPanel?this._oPanel.getP13nData():{}};i.prototype._getDeletes=function(e,t){const r=[],o=this.arrayToMap(t);e.forEach((e,t)=>{if(!o[e.key]){r.push({key:e.key,prevIndex:t})}});return r};i.prototype._getInserts=function(e,t){const r=[],o=this.arrayToMap(e);t.forEach((e,t)=>{if(!o[e.key]){r.push({key:e.key,index:t})}});return r};i.prototype._getMove=function(e,t){const r=[],o=this.arrayToMap(t,true);e.forEach((e,t)=>{if(o[e.key]&&o[e.key].index!==t){r.push({key:e.key,index:o[e.key].index,prevIndex:t})}});return r};i.prototype.applyStateToTable=function(e={}){const t=this.getCurrentState();if(t.length){const r=this.getControl()._getP13nMetadata()[this.getP13nMetadataTarget()]??[],o=this.arrayToMap(r);t.forEach(t=>{if(!o[t.key]){return}if(e[t.key]){e[t.key].vGroup=true}else{e[t.key]=new a(o[t.key].path,false,true)}})}};return i});
//# sourceMappingURL=GroupMediator.js.map