/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","./library","sap/ui/core/EventBus","sap/ui/thirdparty/jquery","sap/ui/core/StaticArea","sap/ui/core/Configuration","sap/ui/core/Theming"],function(e,t,o,jQuery,r,a,s){"use strict";var i="sap-ui-illustration-pool",n="-Patterns",l="sapIllus",u=sap.ui.require.toUrl("sap/m/themes/base/illustrations/"),f=Object.keys(t.IllustratedMessageType);var d=Object.create(null);var c=[],g=Object.create(null),m=Object.create(null),b=Object.create(null);var h={};h.loadAsset=function(t,o,r){var a,s;r=r||"";if(t===""){e.error("ID of the asset can not be blank/empty.");return}s=r+t;if(o){b[o]=s}if(g[s]){e.info("The asset with ID '"+t+"' is either loaded or being loaded.");if(o&&m[s]){h._updateDOMPool()}return}a=t.split("-")[0];if(!d[a]){e.error("The illustration set '"+a+"' is not registered. Please register it before requiring one of its assets.");return}g[s]=true;h._requireSVG(a,t,o,r)};h._extractAssetMetadataConfig=function(e,t,o){var r=h.getIllustrationSetMetadata(e),a=h._getThemePath(r),s=r&&r.oPathSymbolsConfig&&r.oPathSymbolsConfig[a]&&r.oPathSymbolsConfig[a][o],i=r&&r.oPathSymbolsConfig&&r.oPathSymbolsConfig["root"]&&r.oPathSymbolsConfig["root"][o],n=s||i,l=t,u=o;if(n){l=h._getSizeSubstitute(n,t);u=h._getSymbolSubstitute(n,o)}return{sIdPrefix:s?a:"",sAssetId:`${e}-${l}-${u}`}};h._getSymbolSubstitute=function(e,t){if(typeof e==="string"){t=e}else{t=e["symbolReplacement"]||t}return t};h._getSizeSubstitute=function(e,t){if(typeof e==="object"){t=e["sizeReplacement"][t]||t}return t};h.getIllustrationSetMetadata=function(t){if(!d[t]){e.error("The illustration set '"+t+"' is not registered. Please register it before requiring one of its assets.");return null}return d[t]};h.loadRestOfTheAssets=function(e){var t;if(!d[e]){throw new Error("The illustration set '"+e+"' is not registered. Please register it before requiring rest of its assets.")}t=d[e].aSymbols;if(Array.isArray(t)){t.forEach(function(t){h.loadAsset(e+"-Dot-"+t);h.loadAsset(e+"-Spot-"+t);h.loadAsset(e+"-Dialog-"+t);h.loadAsset(e+"-Scene-"+t)})}};h.registerIllustrationSet=async function(t,o,r){var a=t.setFamily,s=t.setURI;if(d[a]){if(d[a].bIsPending){e.warning("Illustration Set is currently being loaded.");return await d[a].oPromise}else{e.warning("Illustration Set already registered.")}return Promise.resolve()}if(s.substr(s.length-1)!=="/"){s+="/"}d[a]=Object.create(null);d[a].sPath=s;d[a].bIsPending=true;await h._loadMetadata(a,s,o,r)};h._addAssetToDOMPool=function(e,t){h._getDOMPool().insertAdjacentHTML("beforeend",e);if(t){c.push(t)}};h._getDOMPool=function(){var e=document.getElementById(i);if(e===null){e=document.createElement("div");e.id=i;e.setAttribute("aria-hidden","true");r.getDomRef().appendChild(e);h.loadAsset(l+n)}return e};h._loadMetadata=async function(t,o,r,a){var s=o+"metadata.json";d[t].oPromise=new Promise(function(o){jQuery.ajax(s,{type:"GET",dataType:"json",success:function(s){e.info("Metadata for illustration set ("+t+") successfully loaded");h._metadataLoaded(t,s,r,a);o(s)},error:function(r,a){if(a!=="abort"){e.error("Metadata from: "+s+" file path could not be loaded");delete d[t];o()}}})});return await d[t].oPromise};h._metadataLoaded=function(e,t,o,r){var a=r||t.symbols,s=t.config&&t.config.themePath,i=t.pathSymbolsConfig,l=t.requireCustomPatterns;d[e].aSymbols=a;d[e].oThemePathMap=s;d[e].oPathSymbolsConfig=i;if(l){h.loadAsset(e+n)}if(o){h.loadRestOfTheAssets(e)}d[e].bIsPending=false;d[e].oPromise=null};h._registerDefaultSet=async function(){const e={setFamily:l,setURI:u};await h.registerIllustrationSet(e,false,f)};h._removeAssetFromDOMPool=function(e){var t=document.getElementById(i),o=e.split("/").pop(),r;if(t!==null){r=document.getElementById(o);if(r!==null){t.removeChild(r);c.splice(c.indexOf(e),1)}}};h._requireSVG=function(t,r,a,s){var i=s+r;s=s||"";return new Promise(function(l){jQuery.ajax(d[t].sPath+s+r+".svg",{type:"GET",dataType:"html",success:function(e){if(r.indexOf(n)===-1){m[i]=e;if(a){h._updateDOMPool()}}else{h._addAssetToDOMPool(e)}l(e)},error:function(t,a){if(a!=="abort"){delete g[i];o.getInstance().publish("sapMIllusPool-assetLdgFailed");e.error(r+" asset could not be loaded");l()}}})})};h._updateDOMPool=function(){var e=Object.create(null),t=Object.create(null),o,r;for(var a in b){o=b[a];r=c.indexOf(o);if(r===-1){t[o]=true}else{e[o]=true}}for(var s=0;s<c.length;s++){o=c[s];if(!e[o]){h._removeAssetFromDOMPool(o);s--}}for(var i in t){o=m[i];if(o){h._addAssetToDOMPool(o,i)}}};h._getThemePath=function(e){var t=s.getTheme(),o=e&&e.oThemePathMap,r=o&&o[t]||"";return r};return h},true);
//# sourceMappingURL=IllustrationPool.js.map