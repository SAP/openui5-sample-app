/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/extend","sap/ui/test/autowaiter/_utils","sap/ui/test/autowaiter/_timeoutWaiter","./WaiterBase"],function(e,t,n,r){"use strict";var o=[];var i=window.Promise;var a=["resolve","reject","all","any","race","allSettled"];var u;var s=r.extend("sap.ui.test.autowaiter._promiseWaiter",{hasPending:function(){var e=o.filter(function(e){return!!e.pending&&!m(e)});if(e.length>0){var t="There are "+e.length+" pending promises\n";e.forEach(function(e){t+=l(e)});c._oHasPendingLogger.debug(t)}return e.length>0},_getDefaultConfig:function(){return e({maxDelay:1e3},r.prototype._getDefaultConfig.call(this))},_getValidationInfo:function(){return e({maxDelay:"numeric"},r.prototype._getValidationInfo.call(this))}});var c=new s;n._registerInitiatorResolverId(function(){return u?u.completorTimeoutId:undefined});function l(e){return"\nPromise: Args: "+e.args+"\n Stack: "+e.stack}function f(){var e=n._getInitiatorId();if(!e&&u){e=u.completorTimeoutId}return e}function g(){var e=n._getInitiatorId();return e}function p(e){var n={args:e,stack:t.resolveStackTrace(),pending:true,tooLate:false,initiatorTimeoutId:f(),longRunnerTimeoutId:setTimeout(function(){n.tooLate=true;n.pending=false;c._oLogger.trace("Long-running promise is ignored:"+l(n))},c._mConfig.maxDelay,"TIMEOUT_WAITER_IGNORE")};c._oLogger.trace("New pending promise:"+l(n));o.push(n);return n}function d(e){if(!e){return}e.completorTimeoutId=g();e.endTime=Date.now();if(e.tooLate){return}else{e.pending=false;c._oLogger.trace("Promise complete:"+l(e));clearTimeout(e.longRunnerTimeoutId)}}function m(e){if(e.initiatorTimeoutId&&n._isPolling(e.initiatorTimeoutId)){c._oLogger.trace("Polling promise is ignored:"+l(e));return true}return false}var v=function(e,n){var r;var o=function(o,i){var a=t.functionToString(e);if(window.ES6Promise&&a==="'function noop() {}'"){c._oLogger.trace("Ignoring internal constructor of ES6 Promise polyfill");return e(o,i)}else if(a==="'function () { [native code] }'"){c._oLogger.trace("Ignoring internal Promise constructor");return e(o,i)}else if(n==="PROMISE_WAITER_IGNORE"){c._oLogger.trace("Ignoring Promise marked to ignore");return e(o,i)}else{r=p(a);var u=function e(){d(r);o.apply(this,arguments)};var s=function e(){d(r);i.apply(this,arguments)};return e(u,s)}};var a=new i(o);function s(e){var t=e.then;e.then=function e(n,o){var i=n;if(n){var i=function e(){u=r;var t=n.apply(this,arguments);u=undefined;return t}}var a=t.apply(this,[i,o]);return a};return e}return s(a)};v.prototype=i.prototype;v.prototype.constructor=v;a.forEach(function(e){if(i[e]){v[e]=i[e]}});const I=i.withResolvers;v.withResolvers=function(){const{promise:e,resolve:t,reject:n,...r}=I.apply(this,arguments);const o=p("");const i=function e(){d(o);t.apply(this,arguments)};const a=function e(){d(o);n.apply(this,arguments)};return{promise:e,resolve:i,reject:a,...r}};window.Promise=v;return c},true);
//# sourceMappingURL=_promiseWaiter.js.map