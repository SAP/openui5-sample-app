/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/test/_OpaLogger","sap/ui/thirdparty/jquery"],function(t,e,jQuery){"use strict";var i="http://localhost:8090";var n=e.getLogger("sap.ui.test._UsageReport");var s=t.extend("sap.ui.test._UsageReport",{constructor:function(e){t.call(this);this.enabled=e&&e.enableUsageReport;this.baseUrl=(e&&e.usageReportUrl||i)+"/api/opa/suites/";if(this.enabled){n.info("Enabled OPA usage report")}var o=s.prototype;Object.keys(o).forEach(function(t){var e=["constructor","getMetadata"].indexOf(t)>-1;if(o.hasOwnProperty(t)&&typeof o[t]==="function"&&!e){var i=o[t];o[t]=function(){if(this.enabled){return i.apply(this,arguments)}}}})},begin:function(t){this._beginSuitePromise=o(this.baseUrl+"begin",t).done(function(t){this._id=t.id;n.debug("Begin report with ID "+t.id)}.bind(this)).fail(function(t){n.debug("Failed to begin report. Error: "+JSON.stringify(t))})},moduleStart:function(t){this._moduleUpdate(t)},testStart:function(){this._isOpaEmpty=false;this._QUnitTimeoutDetails=null},testDone:function(t){if(this._isOpaEmpty){this._reportOpaTest(t);this._isOpaEmpty=false}else{this._QUnitTimeoutDetails=t}},opaEmpty:function(t){this._isOpaEmpty=true;if(t&&t.qunitTimeout){var e=this._QUnitTimeoutDetails.assertions.slice(-1)[0];e.message+="\n"+t.errorMessage;this._reportOpaTest(this._QUnitTimeoutDetails)}},moduleDone:function(t){this._moduleUpdate(t)},done:function(t){this._postSuiteJson("/done",t).done(function(t){n.debug("Completed report with ID "+this._id)}.bind(this)).fail(function(t){n.debug("Failed to complete report with ID "+this._id+". Error: "+JSON.stringify(t))}.bind(this)).always(function(){this._beginSuitePromise=null}.bind(this))},_moduleUpdate:function(t){this._postSuiteJson("/modules",t).done(function(e){n.debug("Sent report for module "+t.name)}).fail(function(e){n.debug("Failed to send report for module '"+t.name+"'. Error: "+JSON.stringify(e))})},_reportOpaTest:function(t){this._postSuiteJson("/tests",t).done(function(e){n.debug("Sent report for test "+t.name)}).fail(function(e){n.debug("Failed send report for test '"+t.name+"'. Error: "+JSON.stringify(e))})},_postSuiteJson:function(t,e){var i=this._beginSuitePromise||(new jQuery.Deferred).resolve().promise();return i.done(function(){return o.call(this,this.baseUrl+this._id+t,e)}.bind(this))}});function o(t,e){return jQuery.ajax({url:t,type:"XHR_WAITER_IGNORE:POST",data:e,dataType:"json"})}return s});
//# sourceMappingURL=_UsageReport.js.map