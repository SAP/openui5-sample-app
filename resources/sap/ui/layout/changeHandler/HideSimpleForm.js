/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/Log"],function(e,t,n){"use strict";var r={};var o=function(e,t){var n=t.getControlType(e);return n==="sap.ui.core.Title"||n==="sap.m.Title"||n==="sap.m.Toolbar"||n==="sap.m.OverflowToolbar"};var i=function(e,t){var n;for(n=0;n<e.length;++n){if(o(e[n],t)){return e[n]}}return undefined};function a(e){return e.modifier.targets==="xmlTree"}r.applyChange=function(e,t,r){var s=r.modifier;var u=r.view;var l=r.appComponent;if(a(r)){return Promise.reject(Error("Change cannot be applied in XML. Retrying in JS."))}var g=e.getContent();var f=s.bySelector(g.elementSelector||g.sHideId,l,u);var c;return this._getState(t,s,l).then(function(n){e.setRevertData(n);return s.getAggregation(t,"content")}).then(function(e){c=e}).then(function(){return c.reduce(function(e,n){return e.then(s.insertAggregation.bind(s,t,"dependents",n,0,u))},Promise.resolve())}).then(function(){return c.reduce(function(e,n,r){return e.then(s.insertAggregation.bind(s,t,"content",n,r,u))},Promise.resolve())}).then(function(){var n=-1;var r=e.getChangeType();if(r==="hideSimpleFormField"){c.some(function(e,t){if(e===f){n=t;s.setVisible(e,false)}if(n>=0&&t>n){if(s.getControlType(e)==="sap.m.Label"||s.getControlType(e)==="sap.ui.comp.smartfield.SmartLabel"||o(e,s)){return true}else{s.setVisible(e,false)}}})}else if(r==="removeSimpleFormGroup"){var a=[];var l=i(c,s);var g=l&&!f;c.some(function(e,r){if(!l){s.setVisible(e,false)}else if(g){n=0;s.setVisible(e,false);g=false}else{if(e===f){n=r}if(n>=0&&r>n){if(o(e,s)){if(n===0){a.push(function(){return Promise.resolve().then(s.removeAggregation.bind(s,t,"content",e,u))});a.push(function(){return Promise.resolve().then(s.insertAggregation.bind(s,t,"content",e,0,u))})}return true}else{s.setVisible(e,false)}}}});if(f){a.push(function(){return Promise.resolve().then(s.removeAggregation.bind(s,t,"content",f,u))});a.push(function(){return Promise.resolve().then(s.insertAggregation.bind(s,t,"dependents",f,0,u))})}if(a.length>0){return a.reduce(function(e,t){return e.then(t)},Promise.resolve())}}return Promise.resolve()}).catch(function(t){e.resetRevertData();n.error(t.message||t.name)})};r._getStableElement=function(e){if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){return e.getTitle()||e.getToolbar()}else if(e.getMetadata().getName()==="sap.ui.layout.form.FormElement"){return e.getLabel()}else{return e}};r.completeChangeContent=function(n,r,o){if(r.removedElement&&r.removedElement.id){var i=this._getStableElement(e.getElementById(r.removedElement.id));n.setContent({elementSelector:t.getSelector(i,o.appComponent)});n.addDependentControl(i,"elementSelector",o)}else{throw new Error("oSpecificChangeInfo.removedElement.id attribute required")}};r._getState=function(e,t,n){return Promise.resolve().then(function(){return t.getAggregation(e,"content")}).then(function(e){if(!e){return Promise.reject(new Error("Cannot get control state: 'content' aggregation doesn't exist"))}return{content:e.map(function(r){return{elementSelector:t.getSelector(t.getId(r),n),visible:r.getVisible?r.getVisible():undefined,index:e.indexOf(r)}})}})};r.revertChange=function(e,t,n){var r=e.getRevertData();var o=n.appComponent;var i=n.modifier;return Promise.resolve().then(i.removeAllAggregation.bind(i,t,"content")).then(function(){return r.content.reduce(function(e,r){var a=i.bySelector(r.elementSelector,o,n.view);var s=i.getId(a);return e.then(i.getAggregation.bind(i,t,"dependents")).then(function(e){var r=Promise.resolve();e.some(function(e){var o=i.getId(e);if(o===s){r=r.then(i.removeAggregation.bind(i,t,"dependents",e,n.view));return true}});return r}).then(i.insertAggregation.bind(i,t,"content",a,r.index,n.view)).then(function(){i.setProperty(a,"visible",r.visible)})},Promise.resolve()).then(function(){e.resetRevertData()})})};r.getChangeVisualizationInfo=function(e){var t=e.getContent().elementSelector;var n=e.getSelector();return{affectedControls:[t],displayControls:[n],updateRequired:true}};return r},true);
//# sourceMappingURL=HideSimpleForm.js.map