/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/util/uid","sap/base/Log"],function(e,t,n,o){"use strict";const r={};const c="moveSimpleFormField";const i="moveSimpleFormGroup";const l="sap.ui.core.Title";const s="sap.m.Title";const u="sap.m.Toolbar";const a="sap.m.OverflowToolbar";const d="sap.m.Label";const g="sap.ui.comp.smartfield.SmartLabel";const p="content";const f="sap.ui.layout.form.FormContainer";function m(e,t,n){return n.reduce(function(n,o){return n.then(function(n){if(n!==undefined){return n}const r=e.getControlType(o);if(t.indexOf(r)===-1){return Promise.resolve().then(e.getVisible.bind(e,o)).then(function(e){return e||undefined})}else{return false}})},Promise.resolve())}function C(e,t,n,o,r,c,i){return m(t,c,n).then(function(n){if(n){const n=r.view;const c=r.appComponent;let s;return Promise.resolve().then(t.createControl.bind(t,l,c,n,i)).then(function(e){s=e;t.setProperty(s,"text","");return t.insertAggregation(o,p,s,0,n)}).then(function(){const t=e.getRevertData();t.createdTitleSelector=r.modifier.getSelector(s,r.appComponent);e.setRevertData(t)})}return Promise.resolve()}).then(function(){return t.getAggregation(o,p)})}function S(e,t,n,o){let r;let c=-1;return m(e,t,n).then(function(i){if(i){c++}for(let i=0;i<n.length;i++){const l=e.getControlType(n[i]);if(t.indexOf(l)>-1){c++;if(c===o){r=n[i];break}}}return n.indexOf(r)})}function h(e,t,n){if(t>=e.length||t===-1){return true}const o=n.getControlType(e[t]);return l===o||u===o||s===o||a===o}function v(e,t,n,o){let r=0;for(r=t+1;r<n.length;++r){const t=e.getControlType(n[r]);if(o.indexOf(t)>-1){break}}return r-t}function I(e,t,n){return v(e,n,t,[l,s,u,a,d,g])}function y(e,t,n,r,c){if(!h(t,n,e)){o.error("Illegal argument. iIndex has to point to a Label.");return-1}else{r=c?r+1:r;let o=0;let i=n;let l;while(i<t.length&&o<r){++o;l=I(e,t,i);i+=l}return i}}function b(e,t,n,o,r){const c=n;for(let n=0;n<r;n++){c.splice(o+n,0,e[t+n])}return c}function x(e){return e.getTitle()||e.getToolbar()}function T(e,t,n){const o=x(t.element);const r=n.modifier.getSelector(e,n.appComponent);const c={elementSelector:n.modifier.getSelector(o,n.appComponent),source:{groupIndex:t.sourceIndex},target:{groupIndex:t.targetIndex}};return{changeType:i,targetSelector:r,movedControl:o,movedElements:[c]}}function P(e,t,n,o,r){const i=r.modifier.getSelector(e,r.appComponent);const l=t.element.getLabel();const s=r.modifier.getSelector(l,r.appComponent);const u=x(o.parent);const a=x(n.parent);const d=r.modifier.getSelector(u,r.appComponent);const g=r.modifier.getSelector(a,r.appComponent);if(!g.id){g.id=n.parent.getId()}if(!d.id){d.id=o.parent.getId()}const p={elementSelector:s,source:{groupSelector:g,fieldIndex:t.sourceIndex},target:{groupSelector:d,fieldIndex:t.targetIndex}};return{changeType:c,targetSelector:i,target:u,source:a,movedControl:l,movedElements:[p]}}function w(e,t,n,o,r,c){return Promise.resolve().then(function(){return r.reduce(function(n,o){return n.then(e.insertAggregation.bind(e,t,"dependents",o,0,c))},Promise.resolve())}).then(function(){return o.reduce(function(n,o,r){return n.then(e.insertAggregation.bind(e,t,p,o,r,c))},Promise.resolve())})}r.applyChange=function(e,t,n){const d=n.modifier;const g=n.view;const f=n.appComponent;let m;let h;let x;const T=e.getContent();const P=T.movedElements[0];return Promise.resolve().then(function(){return d.getAggregation(t,p)}).then(function(p){const E=p.map(function(e){return d.getSelector(e,f)});const O={content:E};e.setRevertData(O);if(e.getChangeType()===c){const e=d.bySelector(P.elementSelector||P.element,f,g);const n=p.indexOf(e);const o=I(d,p,n);const c=d.bySelector(P.source.groupSelector||P.source.groupId,f,g);m=d.bySelector(P.target.groupSelector||P.target.groupId,f,g);const i=p.indexOf(c);const l=p.indexOf(m);const s=y(d,p,l,P.target.fieldIndex,i===l&&P.source.fieldIndex<P.target.fieldIndex);const u=I(d,p,s);h=p.slice();const a=h.slice(n,n+o);let C,S,v,b;if(n<s){C=h.slice(0,n);v=h.slice(n+o,s+u);b=h.slice(s+u,h.length);h=C.concat(v.concat(a.concat(b)))}else if(n>s){S=h.slice(0,s+u);v=h.slice(s+u,n);b=h.slice(n+o,h.length);h=S.concat(a.concat(v.concat(b)))}if(n!=s){return w(d,t,r,h,p,g)}}else if(e.getChangeType()===i){const o=[l,u,s,a];const c=d.bySelector(P.elementSelector||P.element,f,g);return Promise.resolve().then(function(){if(P.target.groupIndex===0||!c){return C(e,d,p,t,n,o,T.newControlId).then(function(e){p=e})}return undefined}).then(function(){x=c?p.indexOf(c):0;return S(d,o,p,P.target.groupIndex)}).then(function(e){m=p[e];const n=v(d,e,p,o);const c=v(d,x,p,o);h=p.slice();h.splice(x,c);e=h.indexOf(m);const i=P.source.groupIndex<P.target.groupIndex?n:0;h=b(p,x,h,e+i,c);return w(d,t,r,h,p,g)})}else{o.warning("Unknown change type detected. Cannot apply to SimpleForm")}})};r.completeChangeContent=function(t,r,c){let i;const l=c.modifier;const s=c.view;const u=c.appComponent;const a=l.bySelector(r.selector,u,s);const d=r.movedElements;if(d.length>1){o.warning("Moving more than 1 Formelement is not yet supported.")}const g=d[0];g.element=e.getElementById(g.id);const p=Object.assign({},r.source);const f=Object.assign({},r.target);if(!f.parent){f.parent=e.getElementById(f.id)}if(!p.parent){p.parent=e.getElementById(p.id)}if(a&&g.element&&f.parent){if(r.changeType==="moveSimpleFormGroup"){i=T(a,g,c)}else if(r.changeType==="moveSimpleFormField"){i=P(a,g,p,f,c)}}else{o.error("Element not found. This may be caused by an unstable id!")}const m={targetSelector:i.targetSelector,movedElements:i.movedElements,newControlId:l.getSelector(s.createId(n()),u)};t.setContent(m);if(i.source&&i.target){t.addDependentControl(i.source,"sourceParent",c);t.addDependentControl(i.target,"targetParent",c)}if(i.movedControl){t.addDependentControl([i.movedControl],"movedElements",c)}};r.revertChange=function(e,t,n){const o=n.modifier;const c=n.appComponent;const i=n.view;const l=e.getRevertData();const s=l.content;return o.getAggregation(t,p).then(function(u){const a=s.map(function(e){return o.bySelector(e,c,i)});return w(o,t,r,a,u,i).then(function(){const t=l.createdTitleSelector;const o=n.modifier.bySelector(t,n.appComponent);if(o){o.destroy()}e.resetRevertData();return true})})};r.getChangeVisualizationInfo=function(e,n){let o;const r=e.getContent().movedElements[0];if(r.elementSelector.id){o=t.bySelector(r.elementSelector,n)}else if(e.getContent().newControlId){o=t.bySelector(e.getContent().newControlId,n)}let i=r.source.groupSelector?{...r.source.groupSelector}:{};const l=r.target.groupSelector?{...r.target.groupSelector}:{};if(e.getChangeType()===c){const e=t.bySelector(i,n);const o=t.bySelector(r.target.groupSelector,n);if(e&&e.isA(f)){i.id=e.getId()}else{i.id=e?e.getParent().getId():null}if(o&&o.isA(f)){l.id=o.getId()}else{l.id=o?o.getParent().getId():null}}else if(!i&&h([o],0,t)){const e=o.getParent();i={id:e.getId()}}const s=o.getParent().getId();return{affectedControls:[s],dependentControls:[i&&i.id?i:e.getContent().targetSelector],updateRequired:true,descriptionPayload:{sourceContainer:i.id,targetContainer:l.id}}};return r},true);
//# sourceMappingURL=MoveSimpleForm.js.map