/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_Helper"],function(e){"use strict";class t{mPredicate2ExpandLevels={};mPredicate2OutOfPlace={};constructor(e,t){this.fnGetKeyFilter=t;this.sNodeProperty=e}collapse(t,i,a){if(!this.sNodeProperty){return}const r=e.getPrivateAnnotation(t,"predicate");const s=this.mPredicate2ExpandLevels[r];if(a||s&&s.levels!==0){delete this.mPredicate2ExpandLevels[r]}else{const a=e.drillDown(t,this.sNodeProperty);this.mPredicate2ExpandLevels[r]={collapseAll:i,levels:0,nodeId:a}}}delete(t){if(!this.sNodeProperty){return}const i=e.getPrivateAnnotation(t,"predicate");delete this.mPredicate2ExpandLevels[i];this.deleteOutOfPlace(i);e.getPrivateAnnotation(t,"spliced",[]).forEach(e=>{this.delete(e)})}deleteExpandLevels(t){delete this.mPredicate2ExpandLevels[e.getPrivateAnnotation(t,"predicate")];e.getPrivateAnnotation(t,"spliced",[]).forEach(e=>{this.deleteExpandLevels(e)})}deleteOutOfPlace(e,t){if(!this.isOutOfPlace(e)){return}if(t){for(;;){const t=this.mPredicate2OutOfPlace[e].parentPredicate;if(!this.isOutOfPlace(t)){break}e=t}}this.mPredicate2OutOfPlace[e].context.setOutOfPlace(false);delete this.mPredicate2OutOfPlace[e];Object.values(this.mPredicate2OutOfPlace).forEach(t=>{if(t.parentPredicate===e){this.deleteOutOfPlace(t.nodePredicate)}})}expand(t,i=1){if(!this.sNodeProperty){return}if(i>=Number.MAX_SAFE_INTEGER){i=null;this.deleteExpandLevels(t)}const a=e.getPrivateAnnotation(t,"predicate");const r=this.mPredicate2ExpandLevels[a];if(r&&!r.levels&&!r.collapseAll){delete this.mPredicate2ExpandLevels[a]}else{const r=e.drillDown(t,this.sNodeProperty);this.mPredicate2ExpandLevels[a]={levels:i,nodeId:r}}}getExpandLevels(){const e=Object.values(this.mPredicate2ExpandLevels);return e.length?JSON.stringify(e.map(e=>({NodeID:e.nodeId,Levels:e.levels}))):undefined}getOutOfPlace(e){return this.mPredicate2OutOfPlace[e]}getOutOfPlaceCount(){return this.getOutOfPlacePredicates().length}getOutOfPlaceGroupedByParent(){const e={};for(const t of Object.values(this.mPredicate2OutOfPlace)){const i=t.parentPredicate;const a=e[i]??={nodeFilters:[],nodePredicates:[],parentFilter:t.parentFilter,parentPredicate:i};a.nodeFilters.push(t.nodeFilter);a.nodePredicates.push(t.nodePredicate)}return Object.values(e)}getOutOfPlacePredicates(){return Object.keys(this.mPredicate2OutOfPlace)}isOutOfPlace(e){return e in this.mPredicate2OutOfPlace}reset(){this.mPredicate2ExpandLevels={};this.resetOutOfPlace()}resetOutOfPlace(){this.getOutOfPlacePredicates().forEach(e=>this.deleteOutOfPlace(e))}setOutOfPlace(t,i){if(t["@$ui5.context.isTransient"]!==false){throw new Error("Not 'created persisted'")}const a={context:e.getPrivateAnnotation(t,"context"),nodeFilter:this.fnGetKeyFilter(t),nodePredicate:e.getPrivateAnnotation(t,"predicate")};a.context.setOutOfPlace(true);if(i){a.parentFilter=this.fnGetKeyFilter(i);a.parentPredicate=e.getPrivateAnnotation(i,"predicate")}this.mPredicate2OutOfPlace[a.nodePredicate]=a}stillOutOfPlace(t,i){t["@$ui5.context.isTransient"]=false;e.setPrivateAnnotation(t,"context",this.mPredicate2OutOfPlace[i].context)}}return t});
//# sourceMappingURL=_TreeState.js.map