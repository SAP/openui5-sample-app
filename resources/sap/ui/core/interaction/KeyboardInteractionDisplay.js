/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/i18n/LanguageFallback","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/Lib","sap/ui/util/XMLHelper"],function(t,e,n,o,i,s,r,a){"use strict";const c="sap.ui.interaction.UpdateDisplay";const l="1.0.0";const u={_version:l,elements:[],docs:{}};const d=new Map;const f=t=>{const e=o.os.macintosh?"Cmd+":"Ctrl+";let n=/\bctrl\b/i.test(t)?e:"";n+=/\balt\b/i.test(t)?"Alt+":"";n+=/\bshift\b/i.test(t)?"Shift+":"";n+=/^(?:.*\+)?(.*)$/.exec(t.trim())[1]||"";return n};const g=t=>{const e=[];const n=t.getDependents?.()||[];for(const t of n){if(t.isA("sap.ui.core.CommandExecution")&&t.getVisible()){const n=t._getCommandInfo();e.push({name:t.getCommand(),kbd:[f(n.shortcut)],description:n.description})}}return e};const m=(t,e)=>{const n=t.getFieldHelpDisplay();const o=n?i.getElementById(n):t;let r=s._getLabelTexts(o)[0];if(!r){const e=t.getAccessibilityInfo?.();if(e){r=e.description||e.children?.[0]?.getAccessibilityInfo?.()?.description||null}}const a="aria-labelledby";if(!r){let n;let o=t;let i=false;while(o&&!n&&!r){const s=t.getDomRef();n=s?.getAttribute(a);if(!n&&!i){i=true;const n=e.documentElement;if(n){const e=[...n.querySelectorAll("control-interactions")];const o=e.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t.getMetadata().getName()));r=o?.querySelector("control")?.querySelector("defaultLabel")?.textContent}}if(!n&&!r){const t=s.querySelector("[aria-labelledby]");n=t?.getAttribute(a)}o=o.getParent?.()}if(!r&&n){const t=document.getElementById(n);r=t?.textContent||null}}return r||t.getMetadata().getName()};const p=async(o,i)=>{let s=o;while(s&&!i){i=s.getMetadata().getLibraryName();s=s.getParent()}if(!i){return null}const c=r._get(i);if(!c?.interactionDocumentation){return null}if(d.has(i)){return d.get(i)}const l=n.getLanguage();const u=e.getFallbackLocales(l);let f=null;while(u.length){const e=u.shift();const n=e?`interaction_${e}.xml`:`interaction.xml`;const o=sap.ui.require.toUrl(`${i.replace(/\./g,"/")}/i18n/${n}`);try{const t=await fetch(o);if(!t.ok){const e=t.statusText||`HTTP status ${t.status}`;throw new Error(`Failed to load resource: ${o} - ${e}`)}const e=await t.text();f=a.parse(e);if(f){d.set(i,f);break}}catch(e){t.error(`Error loading interaction XML for library ${i}:`,e)}}return f};const b=(t,e)=>{const n=e.documentElement;if(!n){return[]}const o=[...n.querySelectorAll("control-interactions")];const i=o.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t));if(!i){return[]}return[...i.querySelectorAll("interaction")].map(t=>({kbd:Array.from(t.children).filter(t=>t.tagName==="kbd").map(t=>f(t.textContent)),description:t.querySelector("description")?.innerHTML||""}))};let y;let h=false;const A=async t=>{if(h){return}h=true;setTimeout(()=>{h=false},300);const e=[];const n={};let o;if(t){o=t.type==="focusin"?t.target:t.relatedTarget}o??=document.activeElement;const s=i.closestTo(o);const a=new Map;const l=await p(null,"sap.ui.core");if(l){const t=r.getResourceBundleFor("sap.ui.core");const e=t.getText("Generic.Keyboard.Interaction.Text");n["sap.ui.core.Control"]={interactions:b("sap.ui.core.Control",l)};a.set(e,{index:-1,class:"sap.ui.core.Control",label:e,interactions:[{$ref:`docs/sap.ui.core.Control/interactions`}]})}let d=s;while(d){e.push(d);d=d.getParent()}for(let t=0;t<e.length;t++){const o=e[t];const i=o.getMetadata().getName();const s=g(o);const r=await p(o);const c=r?b(i,r):[];if(!s.length&&!c.length){continue}const l=o.getMetadata().getName();if(c.length>0){n[l]={interactions:c};s.push({$ref:`docs/${l}/interactions`})}const u=m(o,r);if(!a.has(u)){a.set(u,{interactions:[],label:u})}const d=a.get(u);d.index=t;d.id=o.getId();d.class=l;d.interactions.unshift(...s.reverse())}u.elements=Array.from(a.values()).sort((t,e)=>t.index-e.index).map(t=>{delete t.index;return t});u.docs=n;y?.postMessage(JSON.parse(JSON.stringify({service:c,type:"request",payload:{...u}})))};return{_isActive:false,async activate(t){y=t;if(this._isActive){return}this._isActive=true;await A();document.addEventListener("focusin",A);document.addEventListener("focusout",A)},deactivate(){if(!this._isActive){return}this._isActive=false;document.removeEventListener("focusin",A);document.removeEventListener("focusout",A)}}});
//# sourceMappingURL=KeyboardInteractionDisplay.js.map