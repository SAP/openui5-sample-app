/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/i18n/LanguageFallback","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/Lib","sap/ui/util/XMLHelper"],function(t,e,n,i,o,s,r,a){"use strict";const c="sap.ui.interaction.UpdateDisplay";const l="1.0.0";const u={_version:l,elements:[],docs:{}};const d=new Map;const g=t=>{const e=[];const n=t.getDependents?.()||[];for(const t of n){if(t.isA("sap.ui.core.CommandExecution")&&t.getVisible()){const n=t._getCommandInfo();e.push({name:t.getCommand(),kbd:i.os.macintosh?[n.shortcut.replace("Ctrl","Cmd")]:[n.shortcut],description:n.description})}}return e};const p=t=>{const e=t.getFieldHelpDisplay();const n=e?o.getElementById(e):t;let i=null;const r=t.getAccessibilityInfo?.();if(r){i=r.description||r.children?.[0]?.getAccessibilityInfo?.()?.description||null}if(!i){const e="[aria-labelledby]";const n="aria-labelledby";const o=t.getDomRef();let s=o.getAttribute(n);if(!s){const t=o.querySelector(e);const i=document.activeElement;if(t?.contains(i)){s=t.getAttribute(n)}}i=s?document.getElementById(s)?.textContent:null}return s._getLabelTexts(n)[0]||i||t.getMetadata().getName()};const f=async i=>{if(d.has(i)){return d.get(i)}const o=n.getLanguage();const s=e.getFallbackLocales(o);let r=null;while(s.length){const e=s.shift();const n=e?`interaction_${e}.xml`:`interaction.xml`;const o=sap.ui.require.toUrl(`${i.replace(/\./g,"/")}/i18n/${n}`);try{const t=await fetch(o);if(!t.ok){const e=t.statusText||`HTTP status ${t.status}`;throw new Error(`Failed to load resource: ${o} - ${e}`)}const e=await t.text();r=a.parse(e);if(r){d.set(i,r);break}}catch(e){t.error(`Error loading interaction XML for library ${i}:`,e)}}return r};const m=(t,e)=>{const n=e.documentElement;if(!n){return[]}const i=Array.from(n.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t);if(!i){return[]}return Array.from(n.querySelectorAll("interaction")).map(t=>({kbd:Array.from(t.children).filter(t=>t.tagName==="kbd").map(t=>t.textContent.trim()),description:t.querySelector("description")?.innerHTML||""}))};const b=async t=>{let e=null;let n=t;while(n&&!e){e=n.getMetadata().getLibraryName();n=n.getParent()}if(!e){return[]}const i=r._get(e);if(!i?.interactionDocumentation){return[]}const o=await f(e);if(!o){return[]}const s=t.getMetadata().getName();return m(s,o)};let h;let y=false;const v=async t=>{if(y){return}y=true;setTimeout(()=>{y=false},300);const e=[];const n=[];const i={};const s=o.closestTo(t?.target||document.activeElement);if(!s){return}const a=await f("sap.ui.core");if(a){const t=r.getResourceBundleFor("sap.ui.core");i["sap.ui.core.Control"]={interactions:m("sap.ui.core.Control",a)};n.push({class:"sap.ui.core.Control",label:t.getText("Generic.Keyboard.Interaction.Text"),interactions:[{$ref:`docs/sap.ui.core.Control/interactions`}]})}let l=s;while(l){e.push(l);l=l.getParent()}for(let t=0;t<e.length;t++){const o=e[t];const s=g(o);const r=await b(o);if(!s.length&&!r.length){continue}const a=o.getMetadata().getName();if(r.length>0){i[a]={interactions:r};s.push({$ref:`docs/${a}/interactions`})}n.push({id:o.getId(),class:a,label:p(o),interactions:s})}u.elements=n;u.docs=i;h?.postMessage(JSON.parse(JSON.stringify({service:c,type:"request",payload:{...u}})))};return{_isActive:false,async activate(t){h=t;if(this._isActive){return}this._isActive=true;await v();document.addEventListener("pointerdown",v);document.addEventListener("focusin",v)},deactivate(){if(!this._isActive){return}this._isActive=false;document.removeEventListener("pointerdown",v);document.removeEventListener("focusin",v)}}});
//# sourceMappingURL=KeyboardInteractionDisplay.js.map