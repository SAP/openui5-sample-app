/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/i18n/LanguageFallback","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/Lib","sap/ui/util/XMLHelper"],function(t,e,n,o,s,r,i,a){"use strict";const c="sap.ui.interaction.UpdateDisplay";const l="1.0.0";const u={_version:l,elements:[],docs:{}};const f=new Map;const d=t=>{const e=t.split("+").map(t=>t.trim());const n={ctrl:false,alt:false,shift:false};let s=null;for(const t of e){const e=t.toLowerCase();if(e==="ctrl"){n.ctrl=true}else if(e==="alt"){n.alt=true}else if(e==="shift"){n.shift=true}else if(!s){if(t.length===1){s=t.toUpperCase()}else{s=t}}}const r=[];if(n.ctrl){r.push(o.os.macintosh?"Cmd":"Ctrl")}if(n.alt){r.push("Alt")}if(n.shift){r.push("Shift")}if(s){r.push(s)}return r.join("+")};const g=t=>{const e=i.getResourceBundleFor("sap.ui.core");return t.split("+").map(t=>{const n=`Keyboard.Shortcut.${t.trim()}`;const o=e.getText(n);return o===n?t.trim():o}).join("+")};const m=t=>{const e=t.querySelectorAll("kbd");e.forEach(t=>{const e=d(t.textContent.trim());const n=g(e);t.setAttribute("data-sap-ui-kbd-raw",e);t.textContent=n});return t};const p=t=>{const e=[];const n=t.getDependents?.()||[];for(const t of n){if(t.isA("sap.ui.core.CommandExecution")&&t.getVisible()){const n=t._getCommandInfo();const o=d(n.shortcut);e.push({name:t.getCommand(),kbd:[{raw:o,translated:g(o)}],description:n.description})}}return e};const h=(t,e)=>{const n=t.getFieldHelpDisplay();const o=n?s.getElementById(n):t;let i=r._getLabelTexts(o)[0];if(!i){const e=t.getAccessibilityInfo?.();if(e){i=e.description||e.children?.[0]?.getAccessibilityInfo?.()?.description||null}}const a="aria-labelledby";if(!i){let n;let o=t;let s=false;while(o&&!n&&!i){const r=t.getDomRef();n=r?.getAttribute(a);if(!n&&!s){s=true;const n=e.documentElement;if(n){const e=[...n.querySelectorAll("control-interactions")];const o=e.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t.getMetadata().getName()));i=o?.querySelector("control")?.querySelector("defaultLabel")?.textContent}}if(!n&&!i){const t=r.querySelector("[aria-labelledby]");n=t?.getAttribute(a)}o=o.getParent?.()}if(!i&&n){const t=document.getElementById(n);i=t?.textContent||null}}return i||t.getMetadata().getName()};const b=async(o,s)=>{let r=o;while(r&&!s){s=r.getMetadata().getLibraryName();r=r.getParent()}if(!s){return null}const c=i._get(s);if(!c?.interactionDocumentation){return null}if(f.has(s)){return f.get(s)}const l=n.getLanguage();const u=e.getFallbackLocales(l);let d=null;while(u.length){const e=u.shift();const n=e?`interaction_${e}.xml`:`interaction.xml`;const o=sap.ui.require.toUrl(`${s.replace(/\./g,"/")}/i18n/${n}`);try{const t=await fetch(o);if(!t.ok){const e=t.statusText||`HTTP status ${t.status}`;throw new Error(`Failed to load resource: ${o} - ${e}`)}const e=await t.text();d=a.parse(e);if(d){f.set(s,d);break}}catch(e){t.error(`Error loading interaction XML for library ${s}:`,e)}}return d};const y=(t,e)=>{const n=e.documentElement;if(!n){return[]}const o=[...n.querySelectorAll("control-interactions")];const s=o.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t));if(!s){return[]}return[...s.querySelectorAll("interaction")].map(t=>{const e=Array.from(t.children).filter(t=>t.tagName==="kbd");const n=e.map(t=>{const e=d(t.textContent);return{raw:e,translated:g(e)}});return{kbd:n,description:m(t.querySelector("description"))?.innerHTML||""}})};let A;let v=false;const x=async t=>{if(v){return}v=true;setTimeout(()=>{v=false},300);const e=[];const n={};const o=new Map;let r;if(t){r=t.type==="focusin"?t.target:t.relatedTarget}r??=document.activeElement;const a=s.closestTo(r);const l=await b(null,"sap.ui.core");if(l){const t=i.getResourceBundleFor("sap.ui.core");const e=t.getText("Generic.Keyboard.Interaction.Text");n["sap.ui.core.Control"]={interactions:y("sap.ui.core.Control",l)};o.set(e,{index:-1,class:"sap.ui.core.Control",label:e,interactions:[{$ref:`docs/sap.ui.core.Control/interactions`}]})}let f=a;while(f){e.push(f);f=f.getParent()}for(let t=0;t<e.length;t++){const s=e[t];const r=s.getMetadata().getName();const i=p(s);const a=await b(s);const c=a?y(r,a):[];if(!i.length&&!c.length){continue}const l=s.getMetadata().getName();if(c.length>0){n[l]={interactions:c};i.push({$ref:`docs/${l}/interactions`})}const u=h(s,a);if(!o.has(u)){o.set(u,{interactions:[],label:u})}const f=o.get(u);f.index=t;f.id=s.getId();f.class=l;f.interactions.unshift(...i.reverse())}u.elements=Array.from(o.values()).sort((t,e)=>t.index-e.index).map(t=>{delete t.index;return t});u.docs=n;A?.postMessage(JSON.parse(JSON.stringify({service:c,type:"request",payload:{...u}})))};return{_isActive:false,async activate(t){A=t;if(this._isActive){return}this._isActive=true;await x();document.addEventListener("focusin",x);document.addEventListener("focusout",x)},deactivate(){if(!this._isActive){return}this._isActive=false;document.removeEventListener("focusin",x);document.removeEventListener("focusout",x)},_:{getNormalizedShortcutString:d,translateShortcut:g,annotateAndTranslateKbdTags:m,getInteractions:y,getCommandInfosFor:p}}});
//# sourceMappingURL=KeyboardInteractionDisplay.js.map