/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/future","sap/base/Log","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/merge","sap/ui/base/_runWithOwner","sap/ui/base/ManagedObject","sap/ui/core/Control","sap/ui/base/DesignTime","sap/ui/core/Element","./Controller","./ViewRenderer","./ViewType","./_ViewFactory","./XMLProcessingMode"],function(e,r,t,o,n,s,i,a,c,p,u,l,f,d,g,h){"use strict";var m=c.extend("sap.ui.core.mvc.View",{metadata:{interfaces:["sap.ui.core.IDScope"],abstract:true,library:"sap.ui.core",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},viewName:{type:"string",group:"Misc",defaultValue:null},displayBlock:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},events:{afterInit:{},beforeExit:{},afterRendering:{},beforeRendering:{}},specialSettings:{controller:"sap.ui.core.mvc.Controller",controllerName:"string",preprocessors:"Object",resourceBundleName:"string",resourceBundleUrl:"sap.ui.core.URI",resourceBundleLocale:"string",resourceBundleAlias:"string",type:"string",definition:"any",viewContent:{type:"any",deprecated:true},viewData:"any",async:{type:"boolean",defaultValue:false}},designtime:"sap/ui/core/designtime/mvc/View.designtime"},renderer:f});m._mPreprocessors={};function y(e){e._settings={};for(var r in e){if(r.indexOf("_")!==0){e._settings[r]=e[r]}}}function w(e,r){var t;if(typeof e.preprocessor==="string"){var o=e.preprocessor.replace(/\./g,"/");if(r){return new Promise(function(e,r){sap.ui.require([o],function(r){e(r)},r)})}else{return sap.ui.requireSync(o)}}else if(typeof e.preprocessor==="function"&&!e.preprocessor.process){t={process:e.preprocessor}}else{t=e.preprocessor}if(r){return Promise.resolve(t)}else{return t}}function v(e,r){var t=this.mPreprocessors[r]||[],n=[],s,i,a,c=[];if(m._mPreprocessors[e]&&m._mPreprocessors[e][r]){n=m._mPreprocessors[e][r].map(function(e){return Object.assign({},e)})}for(s=0,i=n.length;s<i;s++){if(n[s]._onDemand){a=n[s]}else{c.push(n[s])}}for(s=0,i=t.length;s<i;s++){var p=!t[s].preprocessor;if(p&&a){c.unshift(o(t[s],a))}else if(!p){c.push(t[s])}}return c}function P(e,r){var t=e.getMetadata().getClass();function o(e){e.preprocessor=w(e,r.async)}e.mPreprocessors=Object.assign({},r.preprocessors);for(var n in t.PreprocessorType){var s=t.PreprocessorType[n];if(e.mPreprocessors[s]&&!Array.isArray(e.mPreprocessors[s])){e.mPreprocessors[s]=[e.mPreprocessors[s]]}else if(!e.mPreprocessors[s]){e.mPreprocessors[s]=[]}e.mPreprocessors[s].forEach(y);e.mPreprocessors[s]=v.call(e,t._sType,s);e.mPreprocessors[s].forEach(o)}}function C(e){e.oAsyncState={};e.oAsyncState.promise=null}var I=function(e,r){var t=r.async;var o=function(r){e.oController=r;r.oView=e};if(!p.isControllerCodeDeactivated()){var n=r.controller,s=n&&typeof n.getMetadata==="function"&&n.getMetadata().getName();if(!n){e.bControllerIsViewManaged=true;let r=e._getControllerModuleName()||e._getControllerName();if(r){var a=sap.ui.require("sap/ui/core/Component");if(a){var c=a.getCustomizing(e,{type:"sap.ui.controllerReplacements",name:r});if(c){r=typeof c==="string"?c:c.controllerName}}if(t){n=l.create({name:r,_viewId:e.sId})}else{n=sap.ui.controller(r,true,false,e.sId)}}}else{e.bControllerIsViewManaged=false;var u=i.getCurrentOwnerId();if(!n._isExtended()){n=l.applyExtensions(n,s,u,e.sId,t)}else if(t){n=Promise.resolve(n)}}if(n){if(t){if(!e.oAsyncState){throw new Error("The view "+e.sViewName+" runs in sync mode and therefore cannot use async controller extensions!")}return n.then(o)}else{o(n)}}}else if(t){const e=Object.assign(new l,{"_sap.ui.core.mvc.EmptyControllerImpl":true});return Promise.resolve(e).then(o)}else{sap.ui.controller("sap.ui.core.mvc.EmptyControllerImpl",{"_sap.ui.core.mvc.EmptyControllerImpl":true});e.oController=sap.ui.controller("sap.ui.core.mvc.EmptyControllerImpl")}};m.prototype._initCompositeSupport=function(s){s=s||{};e(!s.preprocessors||this.getMetadata().getName().indexOf("XMLView"),"Preprocessors only available for XMLView");this.oViewData=s.viewData;this.sViewName=s.viewName;if(this.sViewName&&this.sViewName.startsWith("module:")){this.sViewName=this.sViewName.slice("module:".length).replace(/\//g,".")}var i=this;P(this,s);if(s.async){C(this)}var a=sap.ui.require("sap/ui/core/Component");if(a){var c=a.getCustomizing(this,{type:"sap.ui.viewModifications",name:this.sViewName});if(!n(c)){this._fnSettingsPreprocessor=function(e){var n=this.getId();if(n){if(i.isPrefixedId(n)){n=n.substring((i.getId()+"--").length)}var s=Object.assign({},c[n]);if(s){for(var a in s){if(a!=="visible"){r.warningThrows(`Customizing: property '${a}' of control '${n}' in View '${i.sViewName}' cannot be customized, only 'visible' can.`,{suffix:"Property will be ignored"});delete s[a]}}t.info("Customizing: custom value for property 'visible' of control '"+n+"' in View '"+i.sViewName+"' applied: "+s.visible);e=o(e,s)}}}}}var p=function(r,t){e(typeof r==="function","fn must be a function");var o=a&&a.getOwnerComponentFor(i);if(o){if(t){i.fnScopedRunWithOwner=i.fnScopedRunWithOwner||function(e){return o.runAsOwner(e)}}return o.runAsOwner(r)}return r()};var u=function(e){if(e.oController&&e.oController.connectToView){return e.oController.connectToView(e)}};var l=function(e){if(i.onControllerConnected){return i.onControllerConnected(i.oController,e)}};if(s.async){this.oAsyncState.promise=this.initViewSettings(s).then(function(){return p(I.bind(null,i,s),true)}).then(function(){return p(l.bind(null,s),true)}).then(function(){return u(i)}).then(function(){return i.runPreprocessor("controls",i,false)}).then(function(){return p(i.fireAfterInit.bind(i),true)}).then(function(){return i}).catch(function(e){this.deregister();throw e}.bind(this))}else{this.initViewSettings(s);I(this,s);l(s);u(this);this.runPreprocessor("controls",this,true);this.fireAfterInit()}};m.prototype.getController=function(){return this.oController};m.prototype._getControllerName=function(){return this.getControllerName?.()};m.prototype._getControllerModuleName=function(){return this.getControllerModuleName?.()};m.prototype.byId=function(e){return u.getElementById(this.createId(e))};m.prototype.createId=function(e){if(!this.isPrefixedId(e)){e=this.getId()+"--"+e}return e};m.prototype.getLocalId=function(e){var r=this.getId()+"--";return e&&e.indexOf(r)===0?e.slice(r.length):null};m.prototype.isPrefixedId=function(e){return!!(e&&e.indexOf(this.getId()+"--")===0)};m.prototype.getViewData=function(){return this.oViewData};function b(){this.oAsyncState=null}m.prototype.exit=function(){this.fireBeforeExit();if(this.oController&&this.bControllerIsViewManaged){this.oController.destroy();delete this.oController}delete this.oPreprocessorInfo;if(this.oAsyncState){var e=b.bind(this);this.oAsyncState.promise.then(e,e)}};m.prototype.onAfterRendering=function(){this.fireAfterRendering()};m.prototype.onBeforeRendering=function(){this.fireBeforeRendering()};m.prototype.clone=function(e,t){r.errorThrows("Cloning a View and/or using a View as a binding template is deprecated. Please call the corresponding View factory instead, e.g. XMLView.create()");var o={},n,s;for(n in this.mProperties&&!(this.isBound&&this.isBound(n))){if(this.mProperties.hasOwnProperty(n)){o[n]=this.mProperties[n]}}s=c.prototype.clone.call(this,e,t,{cloneChildren:false,cloneBindings:true});var i,a,p;for(i in s.mEventRegistry){a=s.mEventRegistry[i];for(p=a.length-1;p>=0;p--){if(a[p].oListener===this.getController()){a[p]={oListener:s.getController(),fFunction:a[p].fFunction,oData:a[p].oData}}}}s.applySettings(o);return s};m.prototype.getPreprocessors=function(){return this.mPreprocessors};m.prototype.getPreprocessorInfo=function(e){if(!this.oPreprocessorInfo){this.oPreprocessorInfo={name:this.sViewName,componentId:this._sOwnerId,id:this.getId(),caller:this+" ("+this.sViewName+")",sync:!!e}}if(m._supportInfo){this.oPreprocessorInfo._supportInfo=m._supportInfo}return this.oPreprocessorInfo};m.prototype.runPreprocessor=function(e,r,o){var n=this.getPreprocessorInfo(o),s=this.mPreprocessors&&this.mPreprocessors[e]||[],i,a,c;if(!o){a=function(e,r){return function(t){return r.preprocessor.then(function(o){return o.process(t,e,r._settings)})}};c=Promise.resolve(r)}for(var p=0,u=s.length;p<u;p++){if(o&&s[p]._syncSupport===true){i=s[p].preprocessor.process;r=i(r,n,s[p]._settings)}else if(!o){c=c.then(a(n,s[p]))}else{t.debug('Async "'+e+'"-preprocessor was skipped in sync view execution for '+this.getMetadata().getClass()._sType+"View",this.getId())}}return o?r:c};function V(e,r){if(!m._mPreprocessors[r]){m._mPreprocessors[r]={}}if(!m._mPreprocessors[r][e]){m._mPreprocessors[r][e]=[]}}function _(e,r){return m._mPreprocessors[e][r].some(function(e){return!!e._onDemand})}m.registerPreprocessor=function(e,o,n,s,i,a){if(typeof i!=="boolean"){a=i;i=false}if(o){V(e,n);if(i&&_(n,e)){r.errorThrows(`${this.getMetadata().getName()}: Registration for "${e}" failed, only one on-demand-preprocessor allowed`);return}m._mPreprocessors[n][e].push({preprocessor:o,_onDemand:i,_syncSupport:s,_settings:a});t.debug("Registered "+(i?"on-demand-":"")+'preprocessor for "'+e+'"'+(s?" with syncSupport":""),this.getMetadata().getName())}else{r.errorThrows(`${this.getMetadata().getName()}: Registration for "${e}" failed, no preprocessor specified`)}};m.prototype.hasPreprocessor=function(e){return!!this.mPreprocessors[e].length};m.create=function(e){var r=s({},e);r.async=true;r.viewContent=r.definition;var t=sap.ui.require("sap/ui/core/Component");var o;if(t&&i.getCurrentOwnerId()){o=t.getComponentById(i.getCurrentOwnerId())}function n(){return g.create(r.id,r,r.type).loaded()}return new Promise(function(e,t){var o=g.getViewClassName(r);sap.ui.require([o],function(r){e(r)},t)}).then(function(e){if(e.getMetadata().isA("sap.ui.core.mvc.XMLView")){r.processingMode=h.Sequential}if(o){return o.runAsOwner(n)}else{return n()}})};sap.ui.view=function(e,r,o){var n=typeof e==="string"?e:r;n=typeof n==="object"?n.viewName:n;t.warning("Do not use deprecated view factory functions (View: "+n+"). "+"Use the static create function on the view module instead: [XML|HTML|JSON]View.create().","sap.ui.view",null,function(){return{type:"sap.ui.view",name:n}});return g.create(e,r,o)};m.prototype.loaded=function(){if(this.oAsyncState&&this.oAsyncState.promise){return this.oAsyncState.promise}else{return Promise.resolve(this)}};m.prototype.getAutoPrefixId=function(){return false};m.prototype.onControllerConnected=function(e,r){if(!this.createContent&&typeof this.createContent!=="function"){return}var t={id:this.getAutoPrefixId()?this.createId.bind(this):undefined,settings:this._fnSettingsPreprocessor};return a.runWithPreprocessors(function(){var t=this.createContent(e);if(r.async){t=Promise.resolve(t);return t.then(function(e){this.applySettings({content:e})}.bind(this))}else if(t instanceof Promise){throw new Error("An asynchronous view (createContent) cannot be instantiated synchronously. Affected view: '"+this.getMetadata().getName()+"'.")}else{this.applySettings({content:t})}}.bind(this),t)};m.prototype.initViewSettings=function(e){if(!this.getMetadata()._oRenderer){this.getMetadata().getRenderer=function(){return m.getMetadata().getRenderer()};this.getMetadata().getRendererName=function(){return m.getMetadata().getRendererName()}}if(e.async){return Promise.resolve()}};return m});
//# sourceMappingURL=View.js.map