/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/future","sap/ui/base/EventProvider","sap/ui/base/ManagedObjectMetadata","sap/ui/core/ComponentContainer","sap/ui/core/Element","sap/ui/core/Placeholder","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/core/routing/sync/Target"],function(e,t,i,n,o,r,a,s,l,h){"use strict";var d=s.ComponentLifecycle;var c=r.extend("sap.ui.core.routing.Target.TitleProvider",{metadata:{library:"sap.ui.core",properties:{title:{type:"string",group:"Data",defaultValue:null}}},constructor:function(e){this._oTarget=e.target;delete e.target;r.prototype.constructor.call(this,e)},setTitle:function(e){this.setProperty("title",e,true);if(this._oTarget._bIsDisplayed&&e){this._oTarget.fireTitleChanged({name:this._oTarget._oOptions._name,title:e})}}});var u=i.extend("sap.ui.core.routing.Target",{constructor:function(t,n){var o;function r(){if(new URLSearchParams(window.location.search).get("sap-ui-xx-asyncRouting")==="true"){e.warning("Activation of async view loading in routing via url parameter is only temporarily supported and may be removed soon","Target");return true}return false}if(t._async===undefined){t._async=r()}if(t.type==="Component"&&!t._async){o="sap.ui.core.routing.Target doesn't support loading component in synchronous mode, please switch routing to async";e.error(o);throw new Error(o)}this._updateOptions(t);this._oCache=n;i.apply(this,arguments);if(this._oOptions.title){this._oTitleProvider=new c({target:this})}if(!t._async){for(const e in h){this[e]=h[e]}}this._bIsDisplayed=false;this._bIsLoaded=false},destroy:function(){this._oParent=null;this._oOptions=null;this._oCache=null;if(this._oTitleProvider){this._oTitleProvider.destroy()}this._oTitleProvider=null;i.prototype.destroy.apply(this,arguments);this.bIsDestroyed=true;return this},attachDisplay:function(e,t,i){return this.attachEvent(this.M_EVENTS.DISPLAY,e,t,i)},detachDisplay:function(e,t){return this.detachEvent(this.M_EVENTS.DISPLAY,e,t)},fireDisplay:function(e){var t=this._oTitleProvider&&this._oTitleProvider.getTitle();if(t){this.fireTitleChanged({name:this._oOptions._name,title:t})}this._bIsDisplayed=true;e=e||{};e.config=this._oRawOptions;return this.fireEvent(this.M_EVENTS.DISPLAY,e)},attachTitleChanged:function(e,t,i){var n=this.hasListeners("titleChanged"),o=this._oTitleProvider&&this._oTitleProvider.getTitle();this.attachEvent(this.M_EVENTS.TITLE_CHANGED,e,t,i);if(!n&&o&&this._bIsDisplayed){this.fireTitleChanged({name:this._oOptions._name,title:o})}return this},detachTitleChanged:function(e,t){return this.detachEvent(this.M_EVENTS.TITLE_CHANGED,e,t)},fireTitleChanged:function(e){return this.fireEvent(this.M_EVENTS.TITLE_CHANGED,e)},_getEffectiveObjectName:function(e){var t=this._oOptions.path;if(t&&e&&!e.startsWith("module:")){e=t+"."+e}return e},_updateOptions:function(t){var i=Object.assign({},t);const n=i._async;if(n){if(i.viewName){if(i.name){i._name=i.name}i.type="View";i.name=i.viewName;delete i.viewName;if(i.viewPath){i.path=i.viewPath;delete i.viewPath}if(i.viewId){i.id=i.viewId;delete i.viewId}}}else if(i.type){e.error("Sync Target '"+i._name+"' uses the new options which are only supported by async Target.")}this._oOptions=i;this._oRawOptions=t},_bindTitleInTitleProvider:function(e){if(this._oTitleProvider&&e instanceof l){this._oTitleProvider.applySettings({title:this._oOptions.title},e.getController())}},_addTitleProviderAsDependent:function(e){if(!this._oTitleProvider){return}var t=this._oTitleProvider.getParent();if(t){t.removeDependent(this._oTitleProvider)}if(e instanceof l){e.addDependent(this._oTitleProvider)}},_beforePlacingViewIntoContainer:function(e){},display:function(e){var t=Promise.resolve();return this._display(e,t)},_display:function(e,t,i){if(this._oParent){t=this._oParent._display(e,t,Object.assign({},i))}return this._place(e,t,i)},suspend:function(){if(this._oParent){this._oParent.suspend()}if(this._isLoaded()){var t=this._get(),i;if(t.isA("sap.ui.core.UIComponent")&&(i=t.getRouter())&&t.hasNativeRouter()){i.stop()}}else{e.warning("The target with name '"+this._oOptions._name+"' can't be suspended because it's being loaded or not loaded yet")}return this},resume:function(){if(this._oParent){this._oParent.resume()}if(this._isLoaded()){var e=this._get(),t;if(e.isA("sap.ui.core.UIComponent")&&(t=e.getRouter())&&e.hasNativeRouter()){t.initialize(true)}}return this},_isLoaded:function(){return this._bIsLoaded},_getCreateOptions:function(){var e=this._getEffectiveObjectName(this._oOptions.name),t=this._oOptions,i;switch(t.type){case"View":i={name:e,id:t.id,async:true};if(!e.startsWith("module:")){i.type=t.viewType}break;case"Component":t.id=t.id||n.uid("uicomponent");i={id:t.id};if(t.usage){i.usage=t.usage}else{i.name=e}i=Object.assign({},t.options||{},i);break;default:throw new Error("The given type "+t.type+" isn't support by sap.ui.core.routing.Target")}return i},_get:function(e){var t=this._getCreateOptions();return this._oCache._get(t,this._oOptions.type,this._bUseRawViewId,e)},_load:function(e){var t=this._get(e),i;if(!(t instanceof Promise)){if(t.isA("sap.ui.core.mvc.View")){i=t.loaded()}else{i=Promise.resolve(t)}}else{i=t}return i.then(function(e){this._bIsLoaded=true;return e}.bind(this))},load:function(e){return this._load(e).then(function(t){return{object:t,nestedComponentReady:this.waitForComponentTarget({target:t,createInfo:e})}}.bind(this))},waitForComponentTarget:function(e){return new Promise(function(t,i){var n=e.target;var o=e.createInfo;var r=true;if(n.isA("sap.ui.core.UIComponent")){var a=n.getRouter();if(a&&n.hasNativeRouter()){var s=a.getHashChanger().getHash();var l=a.getRouteByHash(s);var h=o&&o.ignoreInitialHash;if(!a._oConfig.async){throw new Error("The router of component '"+n.getId()+"' which is loaded via the target '"+this._oOptions._name+"' is defined as synchronous which is not supported using as a nested component.")}if(a._oOwner&&o){a._oOwner._bRoutingPropagateTitle=o.propagateTitle}if(!h&&(!a.isInitialized()||a._bMatchingProcessStarted)&&l&&l._oConfig.target){r=false;a.attachRouteMatched(t)}if(a.isStopped()){a.initialize(h)}}}if(r){t()}}.bind(this))},resolveContainerControl:function(e){return Promise.resolve().then(function(){e=e||{};var t=this._oOptions;var i=this._isValid(e);var n;if(i!==true){n=i;return this._refuseInvalidTarget(t._name,n)}var o=e.view,a=e.control,s,l;if(o&&o.isA("sap.ui.core.ComponentContainer")){o=o.getComponentInstance().getRootControl()}if(!o&&t.rootView){s=Promise.resolve(t.rootView).then(function(e){var i;if(e){i=r.getElementById(e);t.rootView=e}if(!i){n="Did not find the root view with the id "+t.rootView;return this._refuseInvalidTarget(t._name,n)}else{return i}}.bind(this))}else{s=Promise.resolve(o)}s=s.then(function(e){if(e&&e.isA("sap.ui.core.mvc.View")){return e.loaded()}else{return e}});if(t.controlId){l=s.then(function(e){var i;if(e){i=e.byId(t.controlId)}if(!i){i=r.getElementById(t.controlId)}return i})}else{l=Promise.resolve(a)}return l.then(function(e){if(!e){n="Control with ID "+t.controlId+" could not be found";return this._refuseInvalidTarget(t._name,n)}else{return e}}.bind(this))}.bind(this))},displayPlaceholder:function(e,t){var i,n=this._oOptions,s=n.type==="Component",l=false,h=e.placeholder||n.placeholder||{},c=Promise.resolve();if(a.hasProviders()){Object.assign(h,a.getPlaceholderFromProviders({name:n.name,type:n.type}))}if(Object.keys(h).length>0){if(h.autoClose===undefined){h.autoClose=true}l=true}if(s){var u=this._oCache._oComponent;var f=n.id+"-container";i=u&&u.byId(f)||r.getElementById(f);if(!i){var p=Object.assign({height:"100%",width:"100%",lifecycle:d.Application},n.containerOptions);if(u){u.runAsOwner(function(){i=new o(u.createId(f),p)})}else{i=new o(f,p)}}if(l){h.container=i}}if(l&&t.isA("sap.ui.core.IPlaceholderSupport")){h.container=t}if(h.container&&!e.repeatedRoute){h.aggregation=this._oOptions.controlAggregation;var g=this._getCreateOptions();var _=this._oCache.fetch(g,this._oOptions.type);if(_&&s){h.object=i}else{h.object=_}if(h.html){h.placeholder=new a({html:h.html})}if(h.placeholder&&a.isEnabled()){c=this.showPlaceholder(h)}}return c.then(function(e){return{containerControl:t,object:i,placeholderConfig:h,placeholderShown:!!e}})},_place:function(t,i,n){var o=this._oOptions,r=this,a,s=o.type==="Component";var l,h;if(t instanceof Promise){n=i;i=t;t=undefined}n=n||{};if((o.name||o.usage)&&o.type){l=this.load(n);if(this._oParent||n.legacy){h=i.then(this.resolveContainerControl.bind(this))}else{h=this.resolveContainerControl()}h=h.then(this.displayPlaceholder.bind(this,n));i=Promise.all([l,h,i]).then(function(e){var t=e[0].object,i=e[1],n,o;i.nestedComponentReady=e[0].nestedComponentReady;if(s){var a=t.destroy;t.destroy=function(){if(a){a.apply(this)}i.object.destroy()};i.object.setComponent(t);o=t.getRootControl();if(o&&o.isA("sap.ui.core.mvc.View")){n=o}}else{i.object=t;n=t}r._bindTitleInTitleProvider(n);r._addTitleProviderAsDependent(n);return i}).then(function(i){var n=i.containerControl,s=i.object;r._beforePlacingViewIntoContainer({container:n,view:s,data:t});var l=n.getMetadata().getJSONKeys()[o.controlAggregation];if(!l){a="Control "+o.controlId+" does not have an aggregation called "+o.controlAggregation;return r._refuseInvalidTarget(o._name,a)}if(o.clearControlAggregation===true){n[l._sRemoveAllMutator]()}e.info("Did place the "+o.type.toLowerCase()+" target '"+(o.name?r._getEffectiveObjectName(o.name):o.usage)+"' with the id '"+s.getId()+"' into the aggregation '"+o.controlAggregation+"' of a control with the id '"+n.getId()+"'",r);n[l._sMutator](s);return{name:o._name,view:s,control:n,nestedComponentReady:i.nestedComponentReady,placeholderConfig:i.placeholderConfig,placeholderShown:i.placeholderShown}})}else{i=i.then(function(){return{name:o._name}})}return i.then(function(e){var i=e.nestedComponentReady||Promise.resolve();return i.then(function(){var i=e.control,o=e.view,a=e.placeholderConfig;if(i&&o){r.fireDisplay({view:o.isA("sap.ui.core.mvc.View")?o:undefined,object:o,control:i,data:t,routeRelevant:n.routeRelevant})}if(a&&a.container&&a.autoClose&&r.hidePlaceholder){r.hidePlaceholder(a)}return e})})},showPlaceholder:function(e){if(e.container&&e.container.showPlaceholder){return e.container.showPlaceholder(e)}else{return Promise.resolve()}},hidePlaceholder:function(e){if(e.container.hidePlaceholder){e.container.hidePlaceholder()}},_isValid:function(e){var i=this._oOptions,n=e&&e.control,o=n||i.controlId,r=true,a="";if(!o){a="The target "+i._name+" has no controlId set and no parent so the target cannot be displayed.";r=false}if(!i.controlAggregation){a="The target "+i._name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";r=false}if(a){t.errorThrows(`${this}: ${a}`)}return r||a},_refuseInvalidTarget:function(e,t){return Promise.reject(new Error(t+" - Target: "+e))},M_EVENTS:{DISPLAY:"display",TITLE_CHANGED:"titleChanged"}});return u});
//# sourceMappingURL=Target.js.map