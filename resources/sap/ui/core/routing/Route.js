/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/assert","sap/base/future","sap/base/util/deepExtend","sap/base/util/extend","sap/ui/base/EventProvider","sap/ui/core/Component","sap/ui/core/routing/Target","sap/ui/core/routing/sync/Route"],function(t,e,r,o,a,n,i,s,u){"use strict";var h=n.extend("sap.ui.core.routing.Route",{metadata:{publicMethods:["getURL","getPattern"]},constructor:function(t,e,o){n.apply(this,arguments);this._validateConfig(e);this._aPattern=[];this._aRoutes=[];this._oParent=o;this._oConfig=e;this._oRouter=t;var a=this,i=e.pattern,h,f,g,c=t._isAsync();if(!c){for(const t in u){this[t]=u[t]}}if(!Array.isArray(i)){i=[i]}if(e.parent){var _=this._getParentRoute(e.parent);if(!_){r.errorThrows(`${this}: No parent route with "${e.parent}" could be found`)}else if(_._aPattern.length>1){r.errorThrows(`${this}: Routes with multiple patterns cannot be used as parent for nested routes`);return}else{this._oNestingParent=_;i.forEach(function(t,e){var r=_._aPattern[0];r=r.charAt(r.length)==="/"?r:r+"/";i[e]=r+t})}}if(Array.isArray(e.subroutes)){h=e.subroutes;e.subroutes={};h.forEach(function(t){e.subroutes[t.name]=t})}if(!e.target){var d=this._convertToTargetOptions(e);d._async=c;this._oTarget=new s(d,t._oViews,o&&o._oTarget);this._oTarget._bUseRawViewId=true}if(e.subroutes){for(f in e.subroutes){g=e.subroutes[f];if(g.name===undefined){g.name=f}t.addRoute(g,a)}}if(e.pattern===undefined){return}i.forEach(function(r,o){a._aPattern[o]=r;a._aRoutes[o]=t._oRouter.addRoute(r);a._checkRoute(a._aRoutes[o]);a._aRoutes[o].greedy=e.greedy;a._aRoutes[o].matched.add(function(){var t={};Array.from(arguments).forEach(function(e,r){t[a._aRoutes[o]._paramsIds[r]]=e});a._routeMatched(t,true)});a._aRoutes[o].switched.add(function(){a._routeSwitched()})})},_checkRoute:function(t){var e=t._paramsIds;if(Array.isArray(e)){var r=e.filter(function(t){return t.charAt(0)==="?"}).filter(function(t){return e.indexOf(t.substring(1))>-1}).map(function(t){return t.substring(1)});if(r.length>0){throw Error("The config of route '"+this._oConfig.name+"' contains standard parameter and query parameter with the same name: '"+r+"'. The name of the routing parameters and query parameter have to differentiate.")}}},_routeSwitched:function(){this._suspend();this.fireEvent("switched",{name:this._oConfig.name})},_suspend:function(){if(this._oRouter._oTargets){this._oRouter._oTargets.suspend(this._oConfig.target);if(this._oConfig.dynamicTarget){this._oRouter._oTargets.suspend(this._oConfig.dynamicTarget)}}},_resume:function(){if(this._oRouter._oTargets){this._oRouter._oTargets.resume(this._oConfig.target);if(this._oConfig.dynamicTarget){this._oRouter._oTargets.resume(this._oConfig.dynamicTarget)}}},destroy:function(){n.prototype.destroy.apply(this);this._aPattern=null;this._aRoutes=null;this._oParent=null;this._oConfig=null;this.bIsDestroyed=true;return this},getURL:function(t){return this._aRoutes[0].interpolate(t||{})},_alignTargetsConfig:function(t){if(!t){return[]}if(!Array.isArray(t)){return typeof t==="string"?[{name:t}]:[t]}return t.map(function(t){if(typeof t==="string"){t={name:t}}return t})},_changeHashWithComponentTargets:function(t,e){var o=this._alignTargetsConfig(this._oConfig.target),a=this._oRouter._oTargets,n,i;if(o&&o.length>0&&a){n=a.getTarget(o);if(!Array.isArray(n)){n=[n]}}else{n=[]}var s=this;i=n.map(function(a,n){if(a._oOptions.type==="Component"){var i=a._load({prefix:o[n].prefix,propagateTitle:o[n].hasOwnProperty("propagateTitle")?o[n].propagateTitle:s._oRouter._oConfig.propagateTitle});return i.then(function(a){var i=a.getRouter(),s=i&&i.getHashChanger(),u=t&&t[o[n].name],h=u&&u.route,f=i&&i.getRoute(h),g;if(u){if(f){g=i._getLastMatchedRouteName()!==h;s.setHash(f.getURL(u.parameters),e||!g);return f._changeHashWithComponentTargets(u.componentTargetInfo,e||g)}else{r.errorThrows("Can not navigate to route with name '"+h+"' because the route does not exist in component with id '"+a.getId()+"'")}}})}return});return Promise.all(i)},getPattern:function(){return this._aPattern[0]},match:function(t){return this._aRoutes.some(function(e){return e.match(t)})},attachMatched:function(t,e,r){return this.attachEvent("matched",t,e,r)},detachMatched:function(t,e){return this.detachEvent("matched",t,e)},attachBeforeMatched:function(t,e,r){return this.attachEvent("beforeMatched",t,e,r)},detachBeforeMatched:function(t,e){return this.detachEvent("beforeMatched",t,e)},fireBeforeMatched:function(t){this.fireEvent("beforeMatched",t);return this},attachPatternMatched:function(t,e,r){return this.attachEvent("patternMatched",t,e,r)},detachPatternMatched:function(t,e){return this.detachEvent("patternMatched",t,e)},_validateConfig:function(t){if(!t.name){r.errorThrows(`${this}: A name has to be specified for every route`)}if(t.viewName){r.errorThrows(`${this}: The 'viewName' option shouldn't be used in Route. please use 'view' instead`)}},_convertToTargetOptions:function(t){return o({},t,{rootView:t.targetParent,controlId:t.targetControl,controlAggregation:t.targetAggregation,clearControlAggregation:t.clearTarget,viewName:t.view,viewType:t.viewType,viewId:t.viewId})},_getParentRoute:function(t){var r=t.split(":");if(r.length===1||r.length===2&&!r[0]){return this._oRouter.getRoute(r[r.length-1])}else{e(this._oRouter._oOwner,"No owner component for "+this._oRouter._oOwner.getId());var o=i.getOwnerComponentFor(this._oRouter._oOwner);while(o){if(o.isA(r[0])){var a=o.getRouter();return a.getRoute(r[1])}o=i.getOwnerComponentFor(o)}return null}},getPatternArguments:function(t){return this._aRoutes[0].extrapolate(t)},_routeMatched:function(e,r,o){var n=this._oRouter,s,u,h,f,g=null,c=null,_,d,p,l,m=n._oMatchedRoute===this;n._sRouteInProgress=null;n._stopWaitingTitleChangedFromChild();if(n._oMatchedRoute){delete n._oMatchedRoute._oConfig.dynamicTarget}n._oMatchedRoute=this;n._bMatchingProcessStarted=true;h=a({},n._oConfig,this._oConfig);u=n.getTargets();var T;if(u){T=u._getTitleTargetName(h.target,h.titleTarget);if(T&&n._oPreviousTitleChangedRoute!==this){n._bFireTitleChanged=true;if(n._oOwner&&n._oOwner._bRoutingPropagateTitle){var R=i.getOwnerComponentFor(n._oOwner);var v=R&&R.getRouter();if(v){v._waitForTitleChangedOn(n)}}}else{n._bFireTitleChanged=false}if(this._oConfig.target){l=u._alignTargetsInfo(this._oConfig.target);l.forEach(function(t){t.propagateTitle=t.hasOwnProperty("propagateTitle")?t.propagateTitle:n._oConfig.propagateTitle;t.routeRelevant=true;t.repeatedRoute=m})}}else{l=this._oConfig.target}if(!r||r===true){_=true;r=Promise.resolve()}if(this._oParent){r=this._oParent._routeMatched(e,r)}else if(this._oNestingParent){this._oNestingParent._routeMatched(e,r,this)}d=Object.assign({},e);d.routeConfig=h;f={name:h.name,arguments:e,config:h};if(o){f.nestedRoute=o}this.fireBeforeMatched(f);n.fireBeforeRouteMatched(f);if(this._oTarget){s=this._oTarget;s._updateOptions(this._convertToTargetOptions(h));r=s._place(r,{legacy:true});if(this._oRouter._oTargetHandler&&this._oRouter._oTargetHandler._chainNavigation){p=r;r=this._oRouter._oTargetHandler._chainNavigation(function(){return p})}}else{r=n._oTargets._display(l,d,this._oConfig.titleTarget,r)}return r.then(function(r){n._bMatchingProcessStarted=false;var o,a,i;if(Array.isArray(r)){o=r;r=o[0]}r=r||{};g=r.view;c=r.control;f.view=g;f.targetControl=c;if(o){a=[];i=[];o.forEach(function(t){a.push(t.view);i.push(t.control)});f.views=a;f.targetControls=i}if(h.callback){h.callback(this,e,h,c,g)}this.fireEvent("matched",f);n.fireRouteMatched(f);if(_){t.info("The route named '"+h.name+"' did match with its pattern",this);this.fireEvent("patternMatched",f);n.fireRoutePatternMatched(f)}return r}.bind(this))}});h.M_EVENTS={BeforeMatched:"beforeMatched",Matched:"matched",PatternMatched:"patternMatched"};return h});
//# sourceMappingURL=Route.js.map