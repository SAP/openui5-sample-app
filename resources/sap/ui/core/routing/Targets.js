/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/future","sap/base/util/deepExtend","sap/ui/base/EventProvider","sap/ui/core/routing/Target","sap/ui/core/routing/sync/Targets"],function(t,e,i,n,a,r){"use strict";var s=n.extend("sap.ui.core.routing.Targets",{constructor:function(e){n.apply(this);this._mTargets={};this._oLastTitleTarget={};this._oCache=e.cache||e.views;if(!e.config){e.config={};e.config._async=false}function i(){if(new URLSearchParams(window.location.search).get("sap-ui-xx-asyncRouting")==="true"){t.warning("Activation of async view loading in routing via url parameter is only temporarily supported and may be removed soon","Targets");return true}return false}if(e.config._async===undefined){e.config._async=e.config.async===undefined?i():e.config.async}if(!e.config._async){for(const t in r){this[t]=r[t]}}this._oConfig=e.config;Object.keys(e.targets).forEach(function(t){this._createTarget(t,e.targets[t])}.bind(this));Object.keys(this._mTargets).forEach(function(t){this._addParentTo(this._mTargets[t])}.bind(this))},_setRouter:function(e){if(!this._oRouter){this._oRouter=e}else{t.warning("The Targets is already connected with a router and this call of _setRouter is ignored")}return this},destroy:function(){var t;n.prototype.destroy.apply(this);for(t in this._mTargets){if(this._mTargets.hasOwnProperty(t)){this._mTargets[t].destroy()}}this._mTargets=null;this._oCache=null;this._oConfig=null;this.bIsDestroyed=true;return this},getViews:function(){return this._oCache},getCache:function(){return this._oCache},getTarget:function(e,i){var n=this,a=this._alignTargetsInfo(e),r;r=a.reduce(function(e,a){var r=n._mTargets[a.name];if(r){e.push(r)}else if(!i){t.error('The target you tried to get "'+a.name+'" does not exist!',n)}return e},[]);return r.length<=1?r[0]:r},addTarget:function(t,i){var n=this.getTarget(t,true),a;if(n){e.errorThrows(`${this}: Target with name "${t}" already exists`)}else{a=this._createTarget(t,i);this._addParentTo(a)}return this},suspend:function(t){var e=this._alignTargetsInfo(t);e.forEach(function(t){var e=t.name;var i=this.getTarget(e);if(i){i.suspend()}}.bind(this));return this},resume:function(t){var e=this._alignTargetsInfo(t);e.forEach(function(t){var e=t.name;var i=this.getTarget(e);if(i){i.resume()}}.bind(this));return this},attachDisplay:function(t,e,i){return this.attachEvent(this.M_EVENTS.DISPLAY,t,e,i)},detachDisplay:function(t,e){return this.detachEvent(this.M_EVENTS.DISPLAY,t,e)},fireDisplay:function(t){return this.fireEvent(this.M_EVENTS.DISPLAY,t)},attachTitleChanged:function(t,e,i){this.attachEvent(this.M_EVENTS.TITLE_CHANGED,t,e,i);return this},detachTitleChanged:function(t,e){return this.detachEvent(this.M_EVENTS.TITLE_CHANGED,t,e)},fireTitleChanged:function(t){if(this._oLastTitleTarget.name!==t.name||this._oLastTitleTarget.title!==t.title){this._oLastTitleTarget.name=t.name;this._oLastTitleTarget.title=t.title;this.fireEvent(this.M_EVENTS.TITLE_CHANGED,t)}return this},M_EVENTS:{DISPLAY:"display",TITLE_CHANGED:"titleChanged"},_alignTargetsInfo:function(t){if(t===undefined){return[]}if(!Array.isArray(t)){return typeof t==="object"?[t]:[{name:t}]}return t.map(function(t){if(typeof t!=="object"){t={name:t}}return t})},_createTarget:function(t,e){var n,a,r={_name:t};if(this._vRootViewId){r.rootView=this._vRootViewId}a=i(r,this._oConfig,e);this._validateOptions(a);n=this._constructTarget(a);n.attachDisplay(function(e){var i=e.getParameters();this.fireDisplay({name:t,view:i.view,object:i.object,control:i.control,config:i.config,data:i.data,routeRelevant:i.routeRelevant})},this);this._mTargets[t]=n;return n},_getDeprecatedOptions:function(){return{viewPath:"path",viewName:"name",viewId:"id"}},_validateOptions:function(t){const e=this._oConfig?.router?._oOwner?.getManifestObject();if(e?._getSchemaVersion()===2){const i=this._getDeprecatedOptions();const n=e.getComponentName();Object.keys(i).forEach(e=>{if(Object.hasOwn(t,e)){throw new Error(`sap.ui5/routing/targets/${e} is deprecated and not supported with manifest version 2. Use the option '${i[e]}' instead (component '${n}').`)}})}},_addParentTo:function(t){var i,n=t._oOptions.parent;if(!n){return}i=this._mTargets[n];if(!i){e.errorThrows(`${this}: The target "${t._oOptions._name}" has a parent "${n}" defined, but it was not found in the other targets`);return}t._oParent=i},_constructTarget:function(t,e){return new a(t,this._oCache,e)},_setRootViewId:function(t){var e,i;for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){i=this._mTargets[e]._oOptions;if(i.rootView===undefined){i.rootView=t}}}this._vRootViewId=t},_getTitleTargetName:function(t,e){var i,n;if(e){t=[e]}t=this._alignTargetsInfo(t);t.some(function(t){i=this.getTarget(t);while(i&&!i._oOptions.title){i=i._oParent}if(i){n=i._oOptions._name;return true}}.bind(this));return n},_forwardTitleChanged:function(t){this.fireTitleChanged({name:t.getParameter("name"),title:t.getParameter("title")})},_attachTitleChanged:function(t,i){var n,a;a=this._getTitleTargetName(t,i);if(a){n=this.getTarget(a)}if(this._oLastDisplayedTitleTarget){this._oLastDisplayedTitleTarget.detachTitleChanged(this._forwardTitleChanged,this);this._oLastDisplayedTitleTarget._bIsDisplayed=false}if(n){n.attachTitleChanged({name:n._oOptions._name},this._forwardTitleChanged,this);this._oLastDisplayedTitleTarget=n}else if(i){e.errorThrows(`${this}: The target with the name "${i}" where the titleChanged event should be fired does not exist!`)}},display:function(t,e,i){var n=Promise.resolve();return this._display(t,e,i,n)},_display:function(t,e,i,n){var a=this,r=[];if(!Array.isArray(t)){t=[t]}this._attachTitleChanged(t,i);return this._alignTargetsInfo(t).reduce(function(t,i){var n={prefix:i.prefix,propagateTitle:i.propagateTitle||false,ignoreInitialHash:i.ignoreInitialHash,placeholder:i.placeholder,repeatedRoute:i.repeatedRoute,routeRelevant:i.routeRelevant||false};return a._displaySingleTarget(i,e,t,n).then(function(t){t=t||{};t.targetInfo=i;r.push(t)})},n).then(function(){return r})},_addDynamicTargetToRoute:function(t){if(this._oRouter){var e=this._oRouter._getLastMatchedRouteName();var i,n;if(e){i=this._oRouter.getRoute(e);if(i&&i._oConfig&&i._oConfig.target){n=this._alignTargetsInfo(i._oConfig.target).some(function(e){return e.name===t.name});if(!n){i._oConfig.dynamicTarget=i._oConfig.dynamicTarget||[];i._oConfig.dynamicTarget.push(t)}}}}},_displaySingleTarget:function(t,i,n,a){var r=t.name,s=this.getTarget(r);if(s!==undefined){if(t.routeRelevant){this._addDynamicTargetToRoute(t)}return s._display(i,n,a)}else{var o=`${this}: The target with the name "${r}" does not exist!`;e.errorThrows(o);return Promise.resolve({name:r,error:o})}}});return s});
//# sourceMappingURL=Targets.js.map