/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/StaticArea","../UIArea","sap/ui/thirdparty/jquery"],function(e,t,r,n,o,i,jQuery){"use strict";var a=e.dnd.RelativeDropPosition;var f={},g=null,s=null,u=null,l=[],c=[],d=null,p,D,h,v,m={},w,A,b;function C(e,t){if(!e){return}if(e.addStyleClass){e.addStyleClass(t)}else{e.$().addClass(t)}}function E(e,t){if(!e){return}if(e.removeStyleClass){e.removeStyleClass(t)}else{e.$().removeClass(t)}}function y(e,t){var r=n.closestTo(e.target,true);if(!r){return}var o=new jQuery.Event(null,e);o.type=t;r.getUIArea()._handleEvent(o)}function T(e,t,r,n=true){const o=new Event(e);if(r){o.dataTransfer=r}const i=new jQuery.Event(o);i.setMark("simulated",n);t.$().trigger(i);return i}function x(e,t){let r=[];const n=e.getParent();const o=n.getMetadata();const i=e.sParentAggregationName;const a=o.getAllAggregations();if(a[i]){r=n[a[i]._sGetter]()}else{const e=o.getAllPrivateAggregations();if(e[i]){r=n.getAggregation(i)}}const f=r.indexOf(e);if(t=="next"){return r.slice(f+1).find(e=>e.getDomRef())}return r.slice(0,f).findLast(e=>e.getDomRef())}function S(e){if(e.isMarked()||!(e.ctrlKey||e.metaKey)||!e.code?.startsWith("Arrow")){return}const t=e.target;const r=t.hasAttribute("data-sap-ui-draghandle")?n.closestTo(t,true):n.getElementById(t.id);if(!r){return}const o=n.getElementById(r.$().closest("[data-sap-ui-draggable]").attr("id"));const i=o?.getParent();const a=o?.sParentAggregationName;if(!i||!a){return}const f=[];const g=[];i.getDragDropConfig().forEach(e=>{if(!e.getKeyboardHandling()){return}if(e.isA("sap.ui.core.dnd.IDropInfo")&&e.getTargetAggregation()==a&&e.getDropPosition()=="Between"){f.push(e)}if(e.isA("sap.ui.core.dnd.IDragInfo")&&e.getSourceAggregation()==a){g.push(e.getGroupName())}});const s=f.find(e=>g.includes(e.getGroupName()));if(!s){return}return{oDragControl:o,oDropConfig:s}}function k(e){return!e.disabled&&/^(input|textarea)$/.test(e.localName)}function I(e,t){if(!e||!e.getDragGhost){return}var r=e.getDragGhost();if(!r){return}if(!D){D=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(D)}D.append(r);window.setTimeout(function(){D.empty()},0);var n=t.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function N(e){var t={},r,n=e.originalEvent.dataTransfer,o=function(e,t){n.setData(e,t)};return{setData:function(e,r){r=""+r;t[e]=r;o(e,r)},getData:function(e){return t[e]},setTextData:function(e){e=""+e;t["text/plain"]=e;t["text"]=e;o("text/plain",e);o("text",e)},getTextData:function(){return t["text/plain"]},setComplexData:function(e,r){t[e]=r},getComplexData:function(e){return t[e]},getIndicator:function(){return p&&p[0]},setIndicatorConfig:function(e){r=e},getIndicatorConfig:function(){return r},getDragControl:function(){return g},getDropControl:function(){return u},setDropControl:function(e){u=e},getDropInfo:function(){return c[0]||null},getDropPosition:function(){return h}}}function R(){g=s=u=d=null;h="";b=false;l=[];c=[]}function B(){if(p){return p}p=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(o.getDomRef()).append(p);return p}function M(){if(p){p.removeAttr("style");p.hide();m={}}}function O(e,r,n,o,i){if(!r){return}const f=e.getMark("simulated");if(f){if(f=="prev"){return a.Before}if(f=="next"){return a.After}}var g=u.getDropAreaRect?u.getDropAreaRect(o):r.getBoundingClientRect(),s=e.dragSession&&e.dragSession.getIndicatorConfig(),l=window.scrollY,c=window.scrollX,d=B(),p,D={},h={top:g.top+l,bottom:g.bottom+l,left:g.left+c,right:g.right+c,width:g.width,height:g.height};if(!n||n=="On"){p=a.On;o=""}else if(o=="Horizontal"){var v=e.pageX-h.left;D.height=h.height;D.top=h.top;if(n=="Between"){D.width="";if(v<h.width*.5){p=a.Before;D.left=h.left}else{p=a.After;D.left=h.right}}else if(n=="OnOrBetween"){if(v<h.width*.25){p=a.Before;D.left=h.left;D.width=""}else if(v>h.width*.75){p=a.After;D.left=h.right;D.width=""}else{p=a.On}}if(p!=a.On&&t.getRTL()){p=p==a.After?a.Before:a.After}}else{var w=e.pageY-h.top;D.width=h.width;D.left=h.left;if(n=="Between"){D.height="";if(w<h.height*.5){p=a.Before;D.top=h.top}else{p=a.After;D.top=h.bottom}}else if(n=="OnOrBetween"){if(w<h.height*.25){p=a.Before;D.top=h.top;D.height=""}else if(w>h.height*.75){p=a.After;D.top=h.bottom;D.height=""}else{p=a.On}}}if(i||s?.display=="none"){return p}if(p==a.On){D.top=h.top;D.left=h.left;D.width=h.width;D.height=h.height;n=p}else{n="Between"}if(m.top!=D.top||m.left!=D.left||m.width!=D.width||m.height!=D.height){d.attr("data-drop-layout",o);d.attr("data-drop-position",n);d.css(Object.assign(D,s));d.show();m=D}return p}function P(e){var t=e.getParent(),r=e.getDragDropConfig?e.getDragDropConfig():[],n=t&&t.getDragDropConfig?t.getDragDropConfig():[];return r.concat(n)}function U(e){var t=P(e);return t.filter(function(t){return t.isDraggable(e)})}function L(e,t,r){var n=P(e);t=t||[];return n.filter(function(e){return!e.isA("sap.ui.core.dnd.IDragInfo")}).concat(t).filter(function(n){if(!n.isDroppable(e,r)){return false}var o=n.getGroupName();if(!o){return true}return t.some(function(e){return e.getGroupName()==o})})}function G(e,t){e.preventDefault();if(g){var r=t.getDropEffect().toLowerCase();e.originalEvent.dataTransfer.dropEffect=r}}function W(e,t,r,n){var o=t.getTargetAggregation();if(!o){return O(e,r.getDomRef(),undefined,undefined,n)}var i;if(e.getMark("DragWithin")==o){i=r.getDomRefForSetting(o)}i=i||r.getDomRef();return O(e,i,t.getDropPosition(true),t.getDropLayout(true),n)}f.preprocessEvent=function(e){if(d&&e.type.indexOf("dr")==0){e.dragSession=d}var t="onbefore"+e.type;if(f[t]){f[t](e)}};f.postprocessEvent=function(e){var t="onafter"+e.type;if(f[t]){f[t](e)}};f.onbeforekeydown=function(e){if(S(e)){e.setMark("dnd")}};f.onafterkeydown=function(e){if(!e.getMark("dnd")){return}let r,n;const{oDragControl:o,oDropConfig:i}=S(e);const a=i.getDropLayout(true);if(a=="Horizontal"&&(e.code=="ArrowRight"||e.code=="ArrowLeft")){const i=t.getRTL()?"prev":"next";const a=t.getRTL()?"next":"prev";r=e.code=="ArrowRight"?i:a;n=x(o,r);e.preventDefault()}if(a=="Vertical"&&(e.code=="ArrowDown"||e.code=="ArrowUp")){r=e.code=="ArrowDown"?"next":"prev";n=x(o,r);e.preventDefault()}if(!n){return}const f=new DataTransfer;const g=T("dragstart",o,f,r);if(g.isDefaultPrevented()||g.isMarked("NonDraggable")){return}const s=T("dragenter",n,f,r);if(!s.isMarked("NonDroppable")){T("drop",n,f,r)}T("dragend",o,f,r)};f.onbeforemousedown=function(e){if(r.browser.firefox&&k(e.target)){w=jQuery(e.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};f.onbeforemouseup=function(e){if(w){w.draggable=true;w=null}};f.onbeforedragstart=function(e){if(!e.target.draggable){return}if(k(document.activeElement)){e.target.getAttribute("data-sap-ui-draggable")&&e.preventDefault();return}g=n.closestTo(e.target,true);if(!g){return}l=U(g);if(!l.length){return}if(!r.system.desktop&&!e.originalEvent.dataTransfer.getData("text")){e.originalEvent.dataTransfer.setData("text"," ")}e.dragSession=d=N(e)};f.onafterdragstart=function(e){if(!l.length||e.isDefaultPrevented()){R();return}l=e.isMarked("NonDraggable")?[]:l.filter(function(t){return t.fireDragStart(e)});if(!l.length){e.preventDefault();R();return}if(e.simulated){return}I(g,e);C(g,"sapUiDnDDragging");if(jQuery(e.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};f.onbeforedragenter=function(e){var t=n.closestTo(e.target,true);if(t&&s===t){e.setMark("DragWithin","SameControl")}else{v=Date.now();s=t}var r=[],o;u=t;for(var i=0;i<20&&u;i++){r=L(u,l,e);if(r.length){break}o=u.getDomRef();o=o&&o.parentElement;u=n.closestTo(o,true)}if(e.getMark("DragWithin")!="SameControl"){c=r;if(d){d.setIndicatorConfig(null)}}if(!c.length){u=null}else if(!d){b=true;e.dragSession=d=N(e)}};f.onafterdragenter=function(e){if(!u||e.isMarked("NonDroppable")){c=[]}else if(e.getMark("DragWithin")!="SameControl"){c=c.filter(function(t){h=W(e,t,u,true);return t.fireDragEnter(e)})}var t=c[0];if(!t||t.getDropEffect()=="None"){M();h=""}else{G(e,t);h=W(e,t,u)}};f.onbeforedragover=function(e){var t=Date.now();if(t-v>=1e3){y(e,"longdragover");v=t}};f.onafterdragover=function(e){if(!u||e.isMarked("NonDroppable")){c=[]}else{c=c.filter(function(t){h=W(e,t,u,true);return t.fireDragOver(e)})}const t=c[0];if(!t||t.getDropEffect()=="None"){M();h=""}else{G(e,t);if(t&&t.getDropPosition(true)=="On"){return}h=W(e,t,u)}};f.onafterdragleave=function(e){if(b&&!e.relatedTarget){M();R()}};f.onbeforedrop=function(e){if(c.length){e.preventDefault()}};f.onafterdrop=function(e){c.forEach(function(t){t.fireDrop(e)});A=requestAnimationFrame(this.onafterdragend.bind(this,e))};f.onafterdragend=function(e){A=cancelAnimationFrame(A);l.forEach(function(t){t.fireDragEnd(e)});E(g,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");M();R()};i.addEventPreprocessor(f.preprocessEvent);i.addEventPostprocessor(f.postprocessEvent);return f},true);
//# sourceMappingURL=DragAndDrop.js.map