/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/DataType","sap/ui/base/BindingInfo","sap/ui/core/CustomData","sap/ui/core/Component","sap/ui/core/ElementRegistry","./mvc/View","./mvc/ViewType","./mvc/_ViewFactory","./mvc/XMLProcessingMode","./mvc/EventHandlerResolver","./ExtensionPoint","./StashedControlSupport","sap/ui/base/SyncPromise","sap/base/future","sap/base/Log","sap/base/util/ObjectPath","sap/base/assert","sap/base/util/LoaderExtensions","sap/base/util/JSTokenizer","sap/base/util/each","sap/base/util/isEmptyObject","sap/ui/base/DesignTime","sap/ui/core/Lib"],function(e,t,n,r,i,a,o,s,u,l,c,f,d,p,g,m,v,h,w,b,y,C,A){"use strict";function N(n,r,i,a,o,s,u){var l=!!s;var c;var f=t.parse(r,a,true,false,false,false,o,l,u);if(l&&f){s.push(f.resolved);c=f.bindingInfo}else{c=f}if(c&&typeof c==="object"){return c}var d=r=typeof c==="string"?c:r;var g=e.getType(n);if(g){if(g instanceof e){d=g.parseValue(r,{context:a,locals:o});if(!g.isValid(d)){p.errorThrows("Value '"+r+"' is not valid for type '"+g.getName()+"'.")}}}else{throw new Error("Property "+i+" has unknown type "+n)}return typeof d==="string"?t.escape(d):d}function M(e){return e.localName||e.nodeName}var _="http://www.w3.org/1999/xhtml";var x="http://www.w3.org/2000/xmlns/";var V="http://www.w3.org/2000/svg";var E="sap.ui.core";var I="sap.ui.core.mvc";var T="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";var P="http://schemas.sap.com/sapui5/extension/sap.ui.core.support.Support.info/1";var S="http://schemas.sap.com/sapui5/extension/sap.ui.core.xmlcomposite/1";var L="http://schemas.sap.com/sapui5/extension/sap.ui.core.Internal/1";var R="http://schemas.sap.com/sapui5/preprocessorextension/";var X=["controllerName","resourceBundleName","resourceBundleUrl","resourceBundleLocale","resourceBundleAlias"];var q=/^(?:area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/;function B(e,t){function n(t,n){var r,i=[];for(var a=0;a<t.childNodes.length;a++){r=e(t,t.childNodes[a],n);if(r){i.push(r.unwrap())}}return d.resolve(i)}function r(t,n){var r=Promise.resolve(),i=[n.chain];for(var a=0;a<t.childNodes.length;a++){r=r.then(e.bind(null,t,t.childNodes[a],n));i.push(r)}return Promise.all(i)}return t?r:n}var U={};U.loadTemplate=function(e,t){var n=e.replace(/\./g,"/")+("."+(t||"view")+".xml");return h.loadResource(n).documentElement};U.loadTemplatePromise=function(e,t){var n=e.replace(/\./g,"/")+("."+(t||"view")+".xml");return h.loadResource(n,{async:true}).then(function(e){return e.documentElement})};U.parseViewAttributes=function(e,t){var n,r;for(n=0;n<e.attributes.length;n++){r=e.attributes[n];if(X.includes(r.name)){if(r.name==="controllerName"&&r.value.startsWith("module:")){t["_controllerModuleName"]=r.value}else{t["_"+r.name]=r.value}}}};U.enrichTemplateIds=function(e,t){U.enrichTemplateIdsPromise(e,t,false);return e};U.enrichTemplateIdsPromise=function(e,t,n){return H(e,t,true,undefined,n).then(function(){return e})};U.parseTemplate=function(e,t,n){return U.parseTemplatePromise(e,t,false,{settings:n}).unwrap()};U.parseTemplatePromise=function(e,t,n,r){return H(e,t,false,r,n).then(function(e){if(t.isA("sap.ui.core.mvc.View")){var n,r;for(r=e.length-1;r>=0;r--){n=e[r];if(n&&n._isExtensionPoint){var i=[r,1].concat(n._aControls);Array.prototype.splice.apply(e,i)}}}return e})};function j(e,t){if(t instanceof Promise){throw new Error(`The module '${e}' returns a Promise where a control class was expected. Promises as module content are not supported. Please also refer to https://ui5.sap.com/#/topic/0cb44d7a147640a0890cefa5fd7c7f8e.`)}}function k(e){const t=/^[a-zA-Z_][a-zA-Z0-9_$]*$/;const n={throwError:false,errorMessage:""};if(!e||typeof e!=="object"){n.errorMessage="core:require in XMLView can't be parsed to a valid object";n.throwError=true;return n}for(const r of Object.keys(e)){if(!t.test(r)){n.errorMessage=`core:require in XMLView contains an invalid identifier: '${r}'`;if(!r.startsWith("$")){n.throwError=true}return n}const i=e[r];if(!i||typeof i!=="string"){n.errorMessage=`core:require in XMLView contains an invalid value '${i}' under key '${r}'`;n.throwError=true;return n}}return n}function O(e,t){var n=e.getAttributeNS(E,"require"),r,i,a;if(n){try{r=w.parseJS(n)}catch(t){g.error("Require attribute can't be parsed on Node: ",e.nodeName);throw t}a=k(r);if(a.errorMessage){const t=`${a.errorMessage} on Node: ${e.nodeName}`;if(a.throwError){throw new Error(t)}else{p.fatalThrows(`${t}. Keys that begin with '$' are reserved by the framework.`)}}if(!y(r)){i={};if(t){return new Promise(function(e,t){var n=Object.keys(r).reduce(function(e,t){i[t]=sap.ui.require(r[t]);return e&&i[t]!==undefined},true);if(n){e(i);return}sap.ui.require(Object.values(r),function(){var t=arguments;Object.keys(r).forEach(function(e,n){i[e]=t[n]});e(i)},t)})}else{Object.keys(r).forEach(function(e){i[e]=sap.ui.requireSync(r[e])});return d.resolve(i)}}}}function $(e,t,n){var r=d.resolve();if(!y(t)){var i=[];var a;if(n){r=new Promise(function(e){a=e})}Object.keys(t).forEach(function(n){var r=t[n];r.forEach(function(t){t.targetControl=e;var n=sap.ui.require(t.providerClass);if(n){i.push(n.applyExtensionPoint(t))}else{var r=new Promise(function(e,n){sap.ui.require([t.providerClass],function(t){e(t)},n)}).then(function(e){return e.applyExtensionPoint(t)});i.push(r)}})});if(n){Promise.all(i).then(a)}}return r}function F(e,t,n){var r=n;for(var i=0;i<100;i++){var a=e.lookupNamespaceURI(r);if(a==null||a===t){return r}r=n+i}throw new Error("Could not find an unused namespace prefix after 100 tries, giving up")}function H(e,h,w,k,H){var D=[],K=F(e,L,"__ui5"),W=O(e,H)||d.resolve(),z=e=>D.push(e);const J={$control:null,$controller:h._oContainingView.oController};const Z={openStart:function(e,t){D.push(["openStart",[e,t]])},voidStart:function(e,t){D.push(["voidStart",[e,t]])},style:function(e,t){D.push(["style",[e,t]])},class:function(e){D.push(["class",[e]])},attr:function(e,t){D.push(["attr",[e,t]])},openEnd:function(){D.push(["openEnd"])},voidEnd:function(){D.push(["voidEnd"])},text:function(e){D.push(["text",[e]])},unsafeHtml:function(e){D.push(["unsafeHtml",[e]])},close:function(e){D.push(["close",[e]])}};if(k?.settings?.requireContext){W=W.then(e=>Object.assign({},k.settings.requireContext,e))}(()=>{H=H&&!!h._sProcessingMode;g.debug("XML processing mode is "+(h._sProcessingMode||"default")+".","","XMLTemplateProcessor")})();g.debug("XML will be processed "+(H?"asynchronously":"synchronously")+".","","XMLTemplateProcessor");var G=C.isDesignModeEnabled();if(G){h._sapui_declarativeSourceInfo={xmlNode:e,xmlRootNode:h._oContainingView===h?e:h._oContainingView._sapui_declarativeSourceInfo.xmlRootNode}}if(!h.isSubView()){e.setAttributeNS(x,"xmlns:"+K,L)}var Q=oe(e,W);var Y=0;function ee(){for(;Y<D.length;Y++){var e=D[Y];if(e&&typeof e.then==="function"){return e.then(te).then(ee)}}return D}function te(e){var t=[Y,1].concat(e);Array.prototype.splice.apply(D,t)}return W.then(ee).then(function(t){if(Q){var n=e.parentNode;n.removeChild(e);if(n.parentNode){n.parentNode.replaceChild(e,n)}}return t});function ne(e){return e}function re(e){return h._oContainingView.createId(e)}function ie(e,t){var n=h.getMetadata().isA("sap.ui.core.mvc.View")?"View":"Fragment";var r=e.outerHTML?e.cloneNode(false).outerHTML:e.textContent;return"Error found in "+n+" (id: '"+h.getId()+"').\nXML node: '"+r+"':\n"+t}function ae(e){var t=M(e),n;const r=h.isA("sap.ui.core.mvc.XMLView")&&(e.namespaceURI===_||e.namespaceURI===V);if(r){n=e.ownerDocument.createElementNS(I,"View")}else if(h.isA("sap.ui.core.Fragment")&&(t!=="FragmentDefinition"||e.namespaceURI!==E)){n=e.ownerDocument.createElementNS(E,"FragmentDefinition")}if(n){var i=e.parentNode;if(i){i.replaceChild(n,e)}n.appendChild(e)}return n}function oe(e,t){var n=false,r=h.sViewName||h._sFragmentName,i,a;if(!r){var o=h;var s=0;while(++s<1e3&&o&&o!==o._oContainingView){o=o._oContainingView}r=o.sViewName}i=ae(e);if(i){e=i;n=true}a=M(e);if(h.isA("sap.ui.core.mvc.XMLView")){if(a!=="View"&&a!=="XMLView"||e.namespaceURI!==I){p.errorThrows("XMLView's root node must be 'View' or 'XMLView' and have the namespace 'sap.ui.core.mvc'"+(r?" (View name: "+r+")":""))}W=t.then(function(){return fe(e,h.getMetadata().getClass(),t,null,{rootArea:true,rootNode:true})})}else{var u=B(function(e,t,n){if(t.nodeType===1){return le(t,n.chain,null,undefined,{rootArea:true})}},H);W=t.then(function(){return u(e,{chain:t})})}return n}function se(e){if(h.fnScopedRunWithOwner){return h.fnScopedRunWithOwner(e)}else{return e()}}function ue(e,t){var n;var r=A.all();b(r,function(r,i){if(e===i.namespace||e===i.name){n=i.name+"."+(i.tagNames&&i.tagNames[t]||t)}});n=n||e+"."+t;function i(e,t){if(!e){let t=`Control '${n}' did not return a class definition from sap.ui.define.`;(()=>{e=m.get(n);if(e){t+=" The control class was instead retrieved via a deprecated access to the global namespace. This fallback behavior will be removed in the next major version (2.0)."}})();p.errorThrows(`XMLTemplateProcessor: ${t}`)}j(t,e);return e}var a=n.replace(/\./g,"/");var o=sap.ui.require(a);if(!o){if(!H){o=sap.ui.requireSync(a);o=i(o,a);return o}return new Promise(function(e,t){sap.ui.require([a],function(n){try{n=i(n,a);e(n)}catch(e){t(e)}},t)})}else{j(a,o)}return o}function le(e,t,n,r,i){var a=i&&i.rootArea,o=i&&i.rootNode&&h.isSubView(),s=M(e),u=a&&(h.isA("sap.ui.core.Fragment")||r&&r.name==="content"),l,c;const f=e.nodeType===3&&u;if(e.nodeType===1){if(e.namespaceURI===_||e.namespaceURI===V){p.warningThrows(`${h.getId()}: Using native HTML content in XMLViews is deprecated.`)}const f=e.namespaceURI===_||e.namespaceURI===V;if(f){if(a){if(r&&r.name!=="content"){g.error(ie(e,"XHTML nodes can only be added to the 'content' aggregation and not to the '"+r.name+"' aggregation."));return d.resolve([])}if(i&&i.contentBound){throw new Error(ie(e,"No XHTML or SVG node is allowed because the 'content' aggregation is bound."))}var m=e.namespaceURI===_;var v=e.getAttribute("id");if(v!=null){v=pe(h,e)}else{v=o?h.getId():undefined}if(s==="style"){var b=e.attributes;var y=e.textContent;e=document.createElement(s);e.textContent=y;for(c=0;c<b.length;c++){var C=b[c];if(!C.prefix){e.setAttribute(C.name,C.value)}}if(v!=null){e.setAttribute("id",v)}if(o){e.setAttribute("data-sap-ui-preserve",h.getId())}Z.unsafeHtml(e.outerHTML);return d.resolve([])}var A=q.test(s);if(A){Z.voidStart(s,v)}else{Z.openStart(s,v)}for(c=0;c<e.attributes.length;c++){var N=e.attributes[c];if(N.name!=="id"&&(N.localName!=="require"||N.namespaceURI!==E)){Z.attr(m?N.name.toLowerCase():N.name,N.value)}}if(o){Z.attr("data-sap-ui-preserve",h.getId())}if(A){Z.voidEnd();if(e.firstChild){g.error("Content of void HTML element '"+s+"' will be ignored")}}else{Z.openEnd();var x=O(e,H);if(x){t=d.all([t,x]).then(function(e){return Object.assign({},...e)})}var I=e instanceof HTMLTemplateElement?e.content:e;var T=B(function(e,t,n){return le(t,n.chain,n.closestBinding,n.aggregation,n.config)},H);l=T(I,{chain:t,closestBinding:n,aggregation:r,config:{rootArea:a}});return l.then(function(e){Z.close(s);return e.reduce(function(e,t){if(Array.isArray(t)){t.forEach(function(t){e.push(t)})}return e},[])})}}else{var P=e.attributes["id"]?e.attributes["id"].textContent||e.attributes["id"].text:null;if(w){return U.enrichTemplateIdsPromise(e,h,H).then(function(){return[]})}else{var S=function(t,n){var r={id:P?pe(h,e,P):undefined,xmlNode:e,requireContext:n,containingView:h._oContainingView};r.processingMode=h._sProcessingMode;return se(function(){return new t(r)})};return t.then(function(e){if(H){return new Promise(function(t,n){sap.ui.require(["sap/ui/core/mvc/XMLView"],function(n){t([S(n,e)])},n)})}else{var t=sap.ui.requireSync("sap/ui/core/mvc/XMLView");return[S(t,e)]}})}}}else{l=ce(e,t,n);if(u){z(l)}return l}}else if(f){if(!i||!i.contentBound){Z.text(e.textContent)}else if(e.textContent.trim()){throw new Error(ie(e,"Text node isn't allowed because the 'content' aggregation is bound."))}}return d.resolve([])}function ce(e,t,n){if(M(e)==="ExtensionPoint"&&e.namespaceURI===E){if(w){return d.resolve([])}else{var r=h instanceof a?h._oContainingView:h;var i=c._factory.bind(null,r,e.getAttribute("name"),function(){var r=d.resolve();var i=[];var a=e.childNodes;for(var o=0;o<a.length;o++){var s=a[o];if(s.nodeType===1){r=r.then(le.bind(null,s,t,n));i.push(r)}}return d.all(i).then(function(e){var t=[];e.forEach(function(e){t=t.concat(e)});return t})},undefined,undefined,H);return d.resolve(se(i))}}else{var o=M(e);var s=o;var u=o.lastIndexOf(".");if(u>=0){s=o.substring(u+1,o.length)}if(/^[a-z].*/.test(s)){var l=h.sViewName||h._sFragmentName||h.getId();g.warning("View or Fragment '"+l+"' contains a Control tag that starts with lower case '"+s+"'",h.getId(),"sap.ui.core.XMLTemplateProcessor#lowerCase")}var f=ue(e.namespaceURI,o);if(f&&typeof f.then==="function"){return f.then(function(r){return fe(e,r,t,n)})}else{return fe(e,f,t,n)}}}function fe(e,c,m,b,C){var A=e.namespaceURI,_={},x={},V="",I=[],q=null,j=null,F=e.getAttribute("stashed")==="true",D=C&&C.rootArea,K=C&&C.rootNode,W;if(!w){e.removeAttribute("stashed")}if(!c){return d.resolve([])}if(K){_.id=h.getId()}var z=c.getMetadata();var Z=z.getAllSettings();var Q=!D?O(e,H):undefined;if(Q){m=d.all([m,Q]).then(function(e){return Object.assign({},e[0],e[1])})}m=m.then(function(r){if(y(r)){r=null}W=r;var i=H?[]:undefined;if(!w){for(var a=0;a<e.attributes.length;a++){var s=e.attributes[a],u=s.name,f=s.namespaceURI,d=Z[u],m=s.value;if(K&&X.includes(u)){continue}if(u==="id"&&!K){_[u]=pe(h,e,m)}else if(u==="class"){V+=m}else if(u==="viewName"){_[u]=m}else if(u==="fragmentName"){_[u]=m;_["containingView"]=h._oContainingView}else if(u==="binding"&&!d||u==="objectBindings"){if(!F){var v=t.parse(m,h._oContainingView.oController);if(v){_.objectBindings=_.objectBindings||{};_.objectBindings[v.model||undefined]=v}}}else if(u==="metadataContexts"){if(!F){var b=null;try{b=U._calculatedModelMapping(m,h._oContainingView.oController,true)}catch(e){p.errorThrows(`Failed to parse metadataContexts in view "${h}"`,{cause:e})}if(b){_.metadataContexts=b;if(U._preprocessMetadataContexts){U._preprocessMetadataContexts(c.getMetadata().getName(),_,h._oContainingView.oController)}}}}else if(u.indexOf(":")>-1){f=s.namespaceURI;if(f===T){var C=M(s);I.push(new n({key:C,value:N("any",m,C,h._oContainingView.oController,r,i)}))}else if(f===P){j=m}else if(f&&f.startsWith(R)){g.debug(h+": XMLView parser ignored preprocessor attribute '"+u+"' (value: '"+m+"')")}else if(f===L&&M(s)==="invisible"){d=Z.visible;if(d&&d._iKind===0&&d.type==="boolean"){_.visible=false}}else if(f===E||f===L||u.startsWith("xmlns:")){}else{if(!q){q={}}if(!q.hasOwnProperty(s.namespaceURI)){q[s.namespaceURI]={}}q[s.namespaceURI][M(s)]=s.nodeValue;g.debug(h+": XMLView parser encountered unknown attribute '"+u+"' (value: '"+m+"') with unknown namespace, stored as sap-ui-custom-settings of customData")}}else if(d&&d._iKind===0){_[u]=N(d.type,m,u,h._oContainingView.oController,r,i,J)}else if(d&&d._iKind===1&&d.altTypes){if(!F){_[u]=N(d.altTypes[0],m,u,h._oContainingView.oController,r,null,J)}}else if(d&&d._iKind===2){if(!F){var v=t.parse(m,h._oContainingView.oController,false,false,false,false,r);if(v){_[u]=v}else{p.errorThrows(""+h+": aggregations with cardinality 0..n specifies a non valid BindingInfo (wrong value: "+u+"='"+m+"')")}}}else if(d&&d._iKind===3){if(!F){_[u]=re(m)}}else if(d&&d._iKind===4){if(!F){_[u]=m.split(/[\s,]+/g).filter(ne).map(re)}}else if(d&&d._iKind===5){if(!F){var A=[];l.parse(m).forEach(function(e){var t=l.resolveEventHandler(e,h._oContainingView.oController,r);if(t){A.push(t)}else{p.warningThrows(""+h+': event handler function "'+e+'" is not a function or does not exist in the controller.')}});if(A.length){_[u]=A}}}else if(d&&d._iKind===-1){if(z.isA("sap.ui.core.mvc.View")&&(u=="async"||u=="type"&&o[m])){_[u]=N(d.type,m,u,h._oContainingView.oController,r)}else{p.warningThrows(""+h+": setting '"+u+"' for class "+z.getName()+" (value:'"+m+"') is not supported")}}else{p.assertThrows(u==="xmlns",h+": encountered unknown setting '"+u+"' for class "+z.getName()+" (value:'"+m+"')");if(U._supportInfo){U._supportInfo({context:e,env:{caller:"createRegularControls",error:true,info:"unknown setting '"+u+"' for class "+z.getName()}})}}}if(q){I.push(new n({key:"sap-ui-custom-settings",value:q}))}if(I.length>0){_.customData=I}}if(Array.isArray(i)){return Promise.all(i).then(function(){return r})}return r}).catch(function(t){if(!t.isEnriched){t=new Error(ie(e,t));t.isEnriched=true;g.error(t)}const n=h._sProcessingMode===u.SequentialLegacy;if(H&&!n){throw t}});var Y=B(ee,H);function ee(e,t,n){var r=n.aggregation,i=n.allAggregations,a=n.chain,o=n.closestBinding,s=n.config,u,l;if(t.nodeType===1){if(t.namespaceURI===S){_[M(t)]=t.querySelector("*");return undefined}u=t.namespaceURI===A&&i&&i[M(t)];if(u){return Y(t,{aggregation:u,allAggregations:null,chain:a,closestBinding:o,config:s})}else if(r){if(t.getAttribute("stashed")==="true"&&!w){var c=t;t=t.cloneNode();c.removeAttribute("stashed");l=function(){var n=pe(h,t);f.createStashedControl({wrapperId:n,fnCreate:function(t){var n=H;if(H===false){t=true}H=!t;try{de(c,"unstash");let n=ee(e,c,{aggregation:r,allAggregations:i,chain:d.resolve(W),closestBinding:o});if(t){n=n.unwrap()}return n}finally{H=n}}})};se(l);t.removeAttribute("visible");de(t,"invisible")}if(_[r.name]&&typeof _[r.name].path==="string"){o={aggregation:r.name,id:_.id};if(K&&r.name==="content"){s=s||{};s.contentBound=true}}return le(t,a,o,r,s).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];var i=r.name;if(n._isExtensionPoint){if(!_[i]){_[i]=[]}var a=x[i];if(!a){a=x[i]=[]}n.index=_[i].length;n.aggregationName=i;n.closestAggregationBindingCarrier=o&&o.id;n.closestAggregationBinding=o&&o.aggregation;var s=a[a.length-1];if(s){s._nextSibling=n}a.push(n)}else if(r.multiple){if(!_[i]){_[i]=[]}if(typeof _[i].path==="string"){v(!_[i].template,"list bindings support only a single template object");_[i].template=n}else{_[i].push(n)}}else{v(!_[i],"multiple aggregates defined for aggregation "+i+" with cardinality 0..1");_[i]=n}}return e})}else{throw new Error(ie(t,"Cannot add direct child without default aggregation defined for control "+z.getElementName()))}}else if(t.nodeType===3){if(s&&s.rootArea){le(t,a,o,r,s)}else{var p=t.textContent||t.text;if(p&&p.trim()){throw new Error(ie(t,"Cannot add text nodes as direct child of an aggregation. For adding text to an aggregation, a surrounding html tag is needed."))}}}}var te=z.getDefaultAggregation();var ae=z.getAllAggregations();return Y(e,{aggregation:te,allAggregations:ae,chain:m,closestBinding:b,config:C}).then(function(){var t;var n=d.resolve();var u=d.resolve();var l=e.getAttribute("type");var f=r.getOwnerComponentFor(h);var p=f?.getManifestObject()?._getSchemaVersion()===2||f?.isA("sap.ui.core.IAsyncContentCreation");if(w){if(!D&&e.hasAttribute("id")){ge(h,e)}}else if(!K&&c.getMetadata().isA("sap.ui.core.mvc.View")){if(!c._sType&&!_.viewName){_.viewName="module:"+c.getMetadata().getName().replace(/\./g,"/")}_.type=c._sType||l;if(H){if(p&&_.async===false){throw new Error("A nested view contained in a Component that uses manifest version 2 or implements 'sap.ui.core.IAsyncContentCreation' is processed asynchronously by default and cannot be processed synchronously.\n"+"Affected Component '"+f.getMetadata().getComponentName()+"' and View '"+_.viewName+"'.")}u=se(function(){return a.create(_)})}else{if(c.getMetadata().isA("sap.ui.core.mvc.XMLView")&&h._sProcessingMode){_.processingMode=h._sProcessingMode}t=se(function(){return s.create(_)})}}else if(c.getMetadata().isA("sap.ui.core.Fragment")&&H){if(l!==o.JS){_.processingMode=h._sProcessingMode}var g="sap/ui/core/Fragment";var m=sap.ui.require(g);_.name=_.name||_.fragmentName;if(m){u=m.load(_)}else{u=new Promise(function(e,t){sap.ui.require([g],function(t){t.load(_).then(function(t){e(t)})},t)})}}else{var v=function(){var t;if(K){t=h;if(!H){if(k&&k.settings){Object.keys(_).forEach(function(e){if(k.settings.hasOwnProperty(e)){k.settings[e]=_[e];delete _[e]}})}}h.applySettings(_)}else{t=se(function(){var t;if(e.getAttributeNS(L,"unstash")==="true"){t=i.get(_.id);if(t.setVisible){t.setVisible(true)}t.applySettings(_)}else{t=new c(_)}return t})}n=$(t,x,H);return t};if(k&&k.fnRunWithPreprocessor){t=k.fnRunWithPreprocessor(v)}else{t=v()}}return u.then(function(e){return e||t}).then(function(t){if(V&&t.addStyleClass){t.addStyleClass(V)}if(!t){t=[]}else if(!Array.isArray(t)){t=[t]}if(U._supportInfo&&t){for(var r=0,i=t.length;r<i;r++){var a=t[r];if(a&&a.getId()){var o=U._supportInfo({context:e,env:{caller:"createRegularControls",nodeid:e.getAttribute("id"),controlid:a.getId()}}),s=j?j+",":"";s+=o;U._supportInfo.addSupportInfo(a.getId(),s)}}}if(G){t.forEach(function(t){if(z.getCompositeAggregationName){var n=e.getElementsByTagName(t.getMetadata().getCompositeAggregationName());for(var r=0;r<n.length;r++){e.removeChild(n[0])}}t._sapui_declarativeSourceInfo={xmlNode:e,xmlRootNode:h._sapui_declarativeSourceInfo.xmlRootNode,fragmentName:z.getName()==="sap.ui.core.Fragment"?_["fragmentName"]:null}})}return n.then(function(){return t})})})}function de(e,t){var n=F(e,L,K);e.setAttributeNS(L,n+":"+t,"true")}function pe(e,t,n){if(t.getAttributeNS(L,"id")){return t.getAttribute("id")}else{return re(n?n:t.getAttribute("id"))}}function ge(e,t){t.setAttribute("id",re(t.getAttribute("id")));de(t,"id")}}U._preprocessMetadataContexts=null;U._calculatedModelMapping=function(e,n,r){var i,a={},o=t.parse(e,n);function s(e){if(e.length%2===0){throw new Error("The last entry is no binding")}for(var t=1;t<=e.length;t=t+2){if(typeof e[t-1]=="string"){throw new Error("Binding expected not a string")}if(e[t]){if(typeof e[t]!="string"||e[t]!=","){throw new Error("Missing delimiter ','")}}}}if(o){if(!o.formatter){i=o;o={parts:[i]}}else{s(o.formatter.textFragments)}for(var u=0;u<o.parts.length;u++){i=o.parts[u];a[i.model]=a[i.model]||(r?[]:null);if(Array.isArray(a[i.model])){a[i.model].push(i)}else{a[i.model]=i}}}return a};return U},true);
//# sourceMappingURL=XMLTemplateProcessor.js.map