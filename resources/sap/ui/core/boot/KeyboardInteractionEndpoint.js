/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log"],function(e){"use strict";let t;function n(){t??=new Promise((e,t)=>{sap.ui.require(["sap/ui/core/interaction/KeyboardInteractionDisplay"],e,t)});return t}function i(t){try{t.port1.onmessage=null;t.port2.onmessage=null;t.port1.close();t.port2.close()}catch(t){e.warning("Error cleaning up channel:",t)}}const o=new Map;const r={"sap.ui.interaction.RequestMessagePort":t=>{const n=t.data;const a=n?.id;if(!a){e.warning("Received MessagePort request without an id. Ignoring.");return}const s=o.get(a);if(s){e.debug(`Detected already-used or neutered port for id '${a}'. Cleaning up and establishing a new channel.`);i(s);o.delete(a)}const c=new MessageChannel;o.set(a,{origin:t.origin,port1:c.port1,port2:c.port2});c.port1.onmessage=e=>{const t=e.data;const n=t?.service;const i=r[n];if(i){i(e,c.port1)}};try{t.source.postMessage({service:"sap.ui.interaction.MessagePortReady"},t.origin,[c.port2])}catch(t){e.error(`Failed to postMessage with port for id '${a}': ${t.message}`,t)}},"sap.ui.interaction.StartDisplay":async(e,t)=>{const i=await n();await i.activate(t)},"sap.ui.interaction.StopDisplay":async e=>{const t=await n();t.deactivate()}};window.addEventListener("message",t=>{const n=t?.data?.service;const i=r[n];if(i){const n=new URL(sap.ui.require.toUrl(""),document.baseURI)?.origin;if(t.origin!==document.location.origin&&t.origin!==n){e.error(`Received message from an unauthorized origin: ${t.origin}.`);return}i?.(t)}});return{run:function(){return Promise.resolve()}}});
//# sourceMappingURL=KeyboardInteractionEndpoint.js.map