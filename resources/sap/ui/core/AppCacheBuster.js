/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/thirdparty/URI","sap/base/config","sap/base/Log","sap/base/i18n/Localization","sap/base/util/extend","sap/base/util/mixedFetch","sap/base/strings/escapeRegExp","sap/ui/core/_IconRegistry"],function(e,t,r,n,o,i,a,s,p){"use strict";const c=o.getLanguage();const u=r.get({name:"sapUiXxAppCacheBusterMode",type:r.Type.String,defaultValue:"sync",external:true,freeze:true});const f=u==="sync";const l=u==="batch";var d={index:{},active:false};var h,y,g,v,b;var L=document.baseURI.replace(/\?.*|#.*/g,"");var m=t(sap.ui.require.toUrl("")+"/../");var x=m.toString();if(m.is("relative")){m=m.absoluteTo(L)}var R=m.normalize().toString();var U=t("resources").absoluteTo(R).toString();var A=new RegExp("^"+s(U));var C=function(e){if(e.length>0&&e.slice(-1)!=="/"){e+="/"}return e};var T=function(e,t){var r=d.index;var o;var s;var p;var u,h;if(Array.isArray(e)&&!l){e.forEach(function(e){T(e,t)})}else if(Array.isArray(e)&&l){var y=C(e[0]);var g=[];n.debug('sap.ui.core.AppCacheBuster.register("'+y+'"); // BATCH MODE!');var v=O.normalizeURL(y);n.debug('  --\x3e normalized to: "'+v+'"');e.forEach(function(e){s=C(e);var t=O.normalizeURL(s);if(!r[p]){g.push(t)}});if(g.length>0){s=v+"sap-ui-cachebuster-info.json?sap-ui-language="+c;o={body:g.join("\n"),headers:{Accept:a.ContentTypes.JSON,"Content-Type":"text/plain"},mode:"POST"};u=function(e){O.onIndexLoaded(s,e);i(r,e)};h=function(e){n.error('Failed to batch load AppCacheBuster index file from: "'+e+'".')}}}else{e=C(e);n.debug('sap.ui.core.AppCacheBuster.register("'+e+'");');p=O.normalizeURL(e);n.debug('  --\x3e normalized to: "'+p+'"');if(!r[p]){s=p+"sap-ui-cachebuster-info.json?sap-ui-language="+c;o={headers:{Accept:a.ContentTypes.JSON},mode:"POST"};u=function(e){O.onIndexLoaded(s,e);r[p]=e};h=function(e){n.error('Failed to load AppCacheBuster index file from: "'+e+'".')}}}if(o){var b=O.onIndexLoad(s);if(b!=null){n.info('AppCacheBuster index file injected for: "'+s+'".');u(b)}else{var L=!f&&!!t;if(L){var m=t.startTask("load "+s);var x=u,R=h;u=function(e){x.apply(this,arguments);t.finishTask(m)};h=function(){R.apply(this,arguments);t.finishTask(m,false)}}n.info('Loading AppCacheBuster index file from: "'+s+'".');a(s,o,!L).then(function(e){if(e.ok){return e.json()}else{throw new Error("Status code: "+e.status)}}).then(u).catch(function(){h(s)})}}};var O={boot:function(e,r){if(r&&r.length>0){var n=true;var o=String(r[0]).toLowerCase();if(r.length===1){if(o==="true"||o==="x"){var i=t(x);r=i.is("relative")?[i.toString()]:[]}else if(o==="false"){n=false}}if(n){O.init();T(r,e)}}},init:function(){d.active=true;h=e.prototype.validateProperty;y=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src");g=Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype,"href");var t=O.convertURL;var r=O.normalizeURL;var o=function(e){if(this.active===true&&e&&typeof e==="string"){e=r(e);return!e.match(A)}return false}.bind(d);v=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,r){if(r&&o(r)){arguments[1]=t(r)}v.apply(this,arguments)};b=XMLHttpRequest.prototype.open;e.prototype.validateProperty=function(e,r){var n=this.getMetadata(),i=n.getProperty(e),a;if(i&&i.type==="sap.ui.core.URI"){a=Array.prototype.slice.apply(arguments);try{if(o(a[1])){a[1]=t(a[1])}}catch(e){}}return h.apply(this,a||arguments)};p._convertUrl=function(e){return t(e)};var i=function(e){var r={get:e.get,set:function(r){if(o(r)){r=t(r)}e.set.call(this,r)},enumerable:e.enumerable,configurable:e.configurable};r.set._sapUiCoreACB=true;return r};var a=false;try{Object.defineProperty(HTMLScriptElement.prototype,"src",i(y))}catch(e){n.error("Your browser doesn't support redefining the src property of the script tag. Disabling AppCacheBuster as it is not supported on your browser!\nError: "+e);a=true}try{Object.defineProperty(HTMLLinkElement.prototype,"href",i(g))}catch(e){n.error("Your browser doesn't support redefining the href property of the link tag. Disabling AppCacheBuster as it is not supported on your browser!\nError: "+e);a=true}if(a){this.exit()}},exit:function(){e.prototype.validateProperty=h;delete p._convertUrl;if(XMLHttpRequest.prototype.open===b){XMLHttpRequest.prototype.open=v}var t;if((t=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"))&&t.set&&t.set._sapUiCoreACB===true){Object.defineProperty(HTMLScriptElement.prototype,"src",y)}if((t=Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype,"href"))&&t.set&&t.set._sapUiCoreACB===true){Object.defineProperty(HTMLLinkElement.prototype,"href",g)}d.index={};d.active=false;d={index:{},active:false}},register:function(e){T(e)},convertURL:function(e){n.debug('sap.ui.core.AppCacheBuster.convertURL("'+e+'");');var t=d.index;if(t&&e&&!/^#/.test(e)){var r=O.normalizeURL(e);n.debug('  --\x3e normalized to: "'+r+'"');if(r&&O.handleURL(r)){for(var o in t){var i=t[o],a,s;if(o&&r.length>=o.length&&r.slice(0,o.length)===o){a=r.slice(o.length);s=a.match(/([^?#]*)/)[1];if(i[s]){e=o+"~"+i[s]+"~/"+a;n.debug('  ==> rewritten to "'+e+'";');break}}}}}return e},normalizeURL:function(e){var r=t(e||"./");if(r.is("relative")){r=r.absoluteTo(L)}return r.normalizeProtocol().normalizeHostname().normalizePort().normalizePath().toString()},handleURL:function(e){return true},onIndexLoad:function(e){return null},onIndexLoaded:function(e,t){}};const z=r.get({name:"sapUiXxAppCacheBusterHooks",type:r.Type.Object,defaultValue:undefined,freeze:true});if(z){["handleURL","onIndexLoad","onIndexLoaded"].forEach(function(e){if(typeof z[e]==="function"){O[e]=z[e]}})}return O},true);
//# sourceMappingURL=AppCacheBuster.js.map