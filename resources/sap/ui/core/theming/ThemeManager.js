/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/Eventing","sap/base/future","sap/base/Log","sap/base/i18n/Localization","sap/base/util/each","sap/base/util/LoaderExtensions","sap/ui/Device","sap/ui/VersionInfo","sap/ui/core/Lib","sap/ui/core/Theming","sap/ui/core/theming/ThemeHelper","sap/ui/dom/includeStylesheet"],function(e,t,r,a,i,s,n,o,u,c,l,d,f){"use strict";const h=new t;const m=150;const p={};const g=/\.sapUiThemeDesignerCustomCss/i;const v="sap-ui-core-customcss";const T="sap-ui-theme-";let b=true;document.querySelectorAll(`link[id^=${T}]`).forEach(function(e){let t=true;const r=e.getAttribute("id").replace(T,"");p[r]={};e.removeAttribute("data-sap-ui-ready");a.info(`ThemeManager: Preloaded CSS for library ${r} detected: ${e.href}`,undefined,"sap.ui.core.theming.ThemeManager");try{t=!!(e.sheet?.href===e.href&&e.sheet?.cssRules);if(!t){b=t;e.addEventListener("load",t=>{const r=t.type==="error";e.setAttribute("data-sap-ui-ready",!r)})}else{e.setAttribute("data-sap-ui-ready",e.sheet.cssRules.length>0)}}catch(t){a.info("Could not detect ready state of preloaded CSS. Request stylesheet again to verify the response status",undefined,"sap.ui.core.theming.ThemeManager");b=false;f({url:e.href,id:e.getAttribute("id")})}});let y=0;let L=false;let A=null;let C=null;let S={};let E;var R={themeLoaded:b,checkThemeApplied:function(){R.reset();w(true);if(!E){R.fireThemeApplied()}},reset:function(){R.themeLoaded=false;if(E){clearTimeout(E);E=null;y=0;C=null;S={}}},_includeLibraryThemeAndEnsureThemeRoot:function(e){var t=e.name;_(t,l.getTheme());_(t,"base");const r=`${t}${e.variant?"-["+e.variant+"]":""}`;e.preloadedCss=e.preloadedCss||!!p[r];p[r]=e;if(!e.preloadedCss){R.includeLibraryTheme(t,e.variant,e)}},includeLibraryTheme:function(t,r,s){e(typeof t==="string","sLibName must be a string");e(r===undefined||typeof r==="string","sVariant must be a string or undefined");var n=s;if(typeof n==="object"){n=M(s)}if(t==="sap.ui.legacy"||t==="sap.ui.classic"){return}if(!r){r=""}var o=i.getRTL()?"-RTL":"";var u,c=t+(r.length>0?"-["+r+"]":r);if(t&&t.indexOf(":")==-1){u="library"+r+o}else{u=t.substring(t.indexOf(":")+1)+r;t=t.substring(0,t.indexOf(":"))}const d=`${T}${c}`;if(!document.querySelector("LINK[id='"+d+"']")){var h=new URL(R._getThemePath(t,l.getTheme()),document.baseURI).toString();var m=document.createElement("link");m.href=h+u+".css"+(n?n:"");var p=m.href;$(d);a.info("Including "+p+" -  sap.ui.core.theming.ThemeManager.includeLibraryTheme()");f(p,d);var g=sap.ui.require("sap/ui/core/theming/Parameters");if(g){g._addLibraryTheme(c)}R.checkThemeApplied()}},_getThemePath:function(e,t){_(e,t);return sap.ui.require.toUrl((e+".themes."+t).replace(/\./g,"/")+"/")},_updateThemeUrls:function(e,t){var r=document.querySelectorAll(`link[id^=${T}]`);Array.prototype.forEach.call(r,function(r){I(r,e,t)})},_attachThemeApplied:function(e){h.attachEvent("applied",e)},_detachThemeApplied:function(e){h.detachEvent("applied",e)},fireThemeApplied:function(){d.reset();var e=sap.ui.require("sap/ui/core/theming/Parameters");if(e){e._reset(true)}h.fireEvent("applied",{theme:l.getTheme()})}};function U(){var e=l.getTheme();var t=R._getThemePath("sap.ui.core",e)+"custom.css";var r=d.isStandardTheme(l.getTheme());var i=true;var n=[];if(L&&A===e){p[v]={}}function o(s){var o=d.checkAndRemoveStyle({prefix:T,id:s});i=i&&o;if(i){if(!L||A!=e){if(!r&&k(s)){var u=t;var c=M(p["sap.ui.core"]);if(c){u+=c}f(u,v);L=true;a.debug("ThemeManager: delivered custom CSS needs to be loaded, Theme not yet applied");A=e;i=false;return false}else if(L){var l=document.querySelector("LINK[id='"+v+"']");if(l){l.remove();a.debug("ThemeManager: Custom CSS removed")}L=false}}}if(!r&&o&&!S[s]){var h=document.getElementById(`${T}${s}`);if(h&&h.getAttribute("data-sap-ui-ready")==="false"&&!(h.sheet&&d.hasSheetCssRules(h.sheet))){n.push(s)}}}s(p,o);if(n.length>0){if(!C){for(var u in p){var c=d.getMetadata(u);if(c&&c.Extends&&c.Extends[0]){C=c.Extends[0]}else{const t=l.getThemeRoot(e,u);if(t){const e=/~v=[^\/]+\(([a-zA-Z0-9_]+)\)/;C=e.exec(t)?.[1];if(C){C=d.validateAndFallbackTheme(C)}}}if(C){break}}}if(C){n.forEach(function(t){const r=document.getElementById(`${T}${t}`);a.warning("ThemeManager: Custom theme '"+e+"' could not be loaded for library '"+t+"'. "+"Falling back to its base theme '"+C+"'.");I(r,C);S[t]=true});i=false}}if(!i){a.debug("ThemeManager: Theme not yet applied.")}else{A=e}return i}function k(e){var t=window.document.getElementById(`${T}${e}`);if(!t){return false}var i=window.getComputedStyle(t,":after");var s=i?i.getPropertyValue("content"):null;if(!s&&o.browser.safari){var n=document.documentElement;n.classList.add("sapUiThemeDesignerCustomCss");s=window.getComputedStyle(n,":after").getPropertyValue("content");n.classList.remove("sapUiThemeDesignerCustomCss")}if(s&&s!=="none"){try{if(s[0]==="'"||s[0]==='"'){s=s.substring(1,s.length-1)}return s==="true"}catch(e){r.errorThrows("Custom check: Error parsing JSON string for custom.css indication.",{cause:e})}}var u=t.sheet?d.safeAccessSheetCssRules(t.sheet):null;if(!u||u.length===0){a.warning("Custom check: Failed retrieving a CSS rule from stylesheet "+e);return false}for(var c=0;c<2&&c<u.length;c++){if(g.test(u[c].selectorText)){return true}}return false}function w(e){y++;var t=y>m;if(!U()&&!t){var a;if(y<=100){a=2}else if(y<=110){a=500}else{a=1e3}E=setTimeout(w,a)}else if(!e){R.reset();R.themeLoaded=true;R.fireThemeApplied();if(t){r.errorThrows("ThemeManager: max. check cycles reached.")}}else{R.themeLoaded=true}}function $(e){var t=document.getElementById(e);if(t){t.dataset.sapUiFoucmarker=e}}function x(e){var t=document.documentElement;var r=e.new;R._updateThemeUrls(r,true);t.classList.remove("sapUiTheme-"+e.old);t.classList.add("sapUiTheme-"+r);R.checkThemeApplied()}function _(e,t){var r=l.getThemeRoot(t,e);if(r){r=r+(r.slice(-1)=="/"?"":"/")+e.replace(/\./g,"/")+"/themes/"+t+"/";n.registerResourcePath((e+".themes."+t).replace(/\./g,"/"),r)}}function I(e,t,r){var a,s=e.href.search(/[?#]/),n,o,u="library",c=i.getRTL()?"-RTL":"",l,d;var h=new RegExp(`^${T}(.*)$`,"i").exec(e.id);if(Array.isArray(h)){a=h[1]}else{a=e.id.slice(T.length)}p[a]=p[a]||{};if(s>-1){n=e.href.substring(0,s);o=e.href.substring(s)}else{n=e.href;o=""}n=n.substring(n.lastIndexOf("/")+1);if((d=a.indexOf("-["))>0){u+=a.slice(d+2,-1);a=a.slice(0,d)}if(n===u+".css"||n===u+"-RTL.css"){n=u+c+".css"}l=new URL(R._getThemePath(a,t)+n+o,document.baseURI).toString();if(l!=e.href){if(r){e.dataset.sapUiFoucmarker=e.id}f(l,e.id)}}function M(e){var t;if(e){t="?version="+e.version;if(u._content){t+="&sap-ui-dist-version="+u._content.version}}return t}document.documentElement.classList.add("sapUiTheme-"+l.getTheme());a.info("Declared theme "+l.getTheme(),null);l.attachChange(function(e){var t=e.themeRoots;var r=e.theme;if(t&&t.forceUpdate){R._updateThemeUrls(l.getTheme())}if(r){x(r)}});l.registerThemeManager(R);if(!R.themeLoaded){R.checkThemeApplied()}return R});
//# sourceMappingURL=ThemeManager.js.map