/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./GridContainerRenderer","./GridContainerSettings","./GridContainerUtils","./GridNavigationMatrix","./delegate/GridContainerItemNavigation","./library","./dnd/GridKeyboardDragAndDrop","sap/base/i18n/Localization","sap/base/strings/capitalize","sap/ui/core/Lib","sap/ui/core/RenderManager","sap/ui/core/delegate/ItemNavigation","sap/ui/base/ManagedObjectObserver","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/core/InvisibleMessage","sap/ui/core/Theming","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery"],function(e,t,i,s,r,n,a,o,u,l,p,h,d,g,c,f,m,y,_,v,jQuery){"use strict";var C={"sap.f.Card":function(e){return e.getCardHeader()||e.getCardContent()},"sap.ui.integration.widgets.Card":function(e){return e.getCardHeader()||e.getCardContent()},"sap.m.GenericTile":function(){return true}};function I(e){var t=e.getLayoutData();return t?t.getColumns():1}function R(e){var t=e.getLayoutData();return t?t.getActualRows():1}function b(e){var t=e.getLayoutData();return t?t.hasAutoHeight():true}var A=g.extend("sap.f.GridContainer",{metadata:{library:"sap.f",interfaces:["sap.f.dnd.IGridDroppable"],properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""},minHeight:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"2rem"},containerQuery:{type:"boolean",group:"Behavior",defaultValue:false},snapToRow:{type:"boolean",group:"Appearance",defaultValue:false},allowDenseFill:{type:"boolean",group:"Appearance",defaultValue:false},inlineBlockLayout:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item",dnd:true},layout:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},layoutXS:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},layoutS:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},layoutM:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},layoutL:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},layoutXL:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false},_defaultLayout:{type:"sap.f.GridContainerSettings",defaultClass:t,multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{layoutChange:{parameters:{layout:{type:"string"}}},columnsChange:{parameters:{columns:{type:"int"}}},borderReached:{parameters:{event:{type:"jQuery.Event"},direction:{type:"sap.f.NavigationDirection"},row:{type:"int"},column:{type:"int"}}}},dnd:{draggable:false,droppable:true}},renderer:e});A.prototype.bUseExtendedChangeDetection=true;A.prototype.getActiveLayoutSettings=function(){var e=this.getAggregation(this._sActiveLayout);if(!e&&this._sActiveLayout==="layoutXS"){e=this.getAggregation("layoutS")}if(!e){e=this.getAggregation("layout")||this.getAggregation("_defaultLayout")}return e};A.prototype._onBeforeItemRendering=function(){var e=this.getParent();if(e._resizeListeners[this.getId()]){f.deregister(e._resizeListeners[this.getId()]);delete e._resizeListeners[this.getId()]}e._reflectItemVisibilityToWrapper(this)};A.prototype._onAfterItemRendering=function(){var e=this.getParent();e._checkOwnVisualFocus(this);e._resizeListeners[this.getId()]=f.register(this,e._resizeItemHandler);e._setItemNavigationItems();e._applyItemAutoRows(this)};A.prototype._onItemWrapperFocusIn=function(e){var t=this._oItemNavigation.getFocusedDomRef(),i,s;if(!t||!t.firstChild){return}i=c.closestTo(t.firstChild);if(!i||!i.getAriaRoleDescription){return}s=i.getAriaRoleDescription();if(s){m.getInstance().announce(s)}};A.prototype._reflectItemVisibilityToWrapper=function(e){var t=i.getItemWrapper(e),s;if(!t){return}s=jQuery(t);if(e.getVisible()&&s.hasClass("sapFGridContainerInvisiblePlaceholder")){s.removeClass("sapFGridContainerInvisiblePlaceholder")}else if(!e.getVisible()&&!s.hasClass("sapFGridContainerInvisiblePlaceholder")){s.addClass("sapFGridContainerInvisiblePlaceholder")}};A.prototype._onItemChange=function(e){if(e.name!=="items"||!e.child){return}if(e.mutation==="insert"){e.child.addEventDelegate(this._itemDelegate,e.child)}else if(e.mutation==="remove"){e.child.removeEventDelegate(this._itemDelegate,e.child)}};A.prototype._deregisterResizeListeners=function(){var e,t;for(e in this._resizeListeners){t=this._resizeListeners[e];f.deregister(t)}delete this._resizeListeners;_.resize.detachHandler(this._resizeDeviceHandler)};A.prototype._setItemNavigationItems=function(){if(!this._isRenderingFinished){return}var e=this,t=[];if(!e._oItemNavigation){e._oItemNavigation=(new r).setCycling(false).setDisabledModifiers({sapnext:["alt","meta","ctrl"],sapprevious:["alt","meta","ctrl"]}).setTableMode(true,true).setFocusedIndex(0).attachEvent(h.Events.AfterFocus,this._onItemWrapperFocusIn.bind(this));e.addDelegate(this._oItemNavigation)}e.$("listUl").children().map(function(e,i){if(i.getAttribute("class").indexOf("sapFGridContainerItemWrapper")>-1){t.push(i)}});e._oItemNavigation.setRootDomRef(e.getDomRef());e._oItemNavigation.setItemDomRefs(t)};A.prototype._detectActiveLayout=function(){var e=this.getContainerQuery()&&this.getDomRef()?this._getComputedWidth():_.resize.width,t=_.media.getCurrentRange("GridContainerRangeSet",e),i="layout"+t.name,s=this.getActiveLayoutSettings(),r=false;if(!e){return false}if(this._sActiveLayout!==i){this.addStyleClass("sapFGridContainer"+u(i));if(this._sActiveLayout){this.removeStyleClass("sapFGridContainer"+u(this._sActiveLayout))}this._sActiveLayout=i;r=s!==this.getActiveLayoutSettings();this.fireLayoutChange({layout:this._sActiveLayout})}return r};A.prototype._detectColumnsChange=function(){var e=this.getActiveLayoutSettings(),t=this.$().innerWidth(),i;if(!e){return}i=e.getComputedColumnsCount(t);if(this._iColumns!==i){this.fireColumnsChange({columns:i});this._iColumns=i}};A.prototype._getActiveGridStyles=function(){var e=this.getActiveLayoutSettings(),t=e.getColumns()||"auto-fill",i=e.getColumnSize(),s=e.getMinColumnSize(),r=e.getMaxColumnSize(),n={"grid-gap":e.getGap()};if(s&&r){n["grid-template-columns"]="repeat("+t+", minmax("+s+", "+r+"))"}else{n["grid-template-columns"]="repeat("+t+", "+i+")"}if(this.getInlineBlockLayout()){n["grid-auto-rows"]="min-content"}else{n["grid-auto-rows"]=e.getRowSize()}return n};A.prototype.init=function(){this._oRb=l.getResourceBundleFor("sap.f");this.setAggregation("_defaultLayout",new t);this._initRangeSet();this._resizeListeners={};this._oItemNavigation=null;this._itemDelegate={onBeforeRendering:this._onBeforeItemRendering,onAfterRendering:this._onAfterItemRendering};this._itemsObserver=new d(this._onItemChange.bind(this));this._itemsObserver.observe(this,{aggregations:["items"]});this._resizeHandler=this._resize.bind(this);this._resizeDeviceHandler=this._resizeDevice.bind(this);_.resize.attachHandler(this._resizeDeviceHandler);this._resizeItemHandler=this._resizeItem.bind(this);this._bThemeApplied=false;this._handleThemeAppliedBound=this._handleThemeApplied.bind(this);y.attachApplied(this._handleThemeAppliedBound)};A.prototype.insertItem=function(e,t){this.insertAggregation("items",e,t,true);if(!this.getDomRef()||!e.getVisible()){this.invalidate();return this}t=Math.max(0,Math.min(t,this.getItems().length-1));var i=(new p).getInterface(),s=this._createItemWrapper(e),r=this.getDomRef("listUl"),n=r.children[t];if(n){r.insertBefore(s,n)}else{r.appendChild(s)}i.render(e,s);i.destroy();return this};A.prototype.removeItem=function(e){var t=this.removeAggregation("items",e,true),i=this.getDomRef("listUl"),s=t.getDomRef();if(!i||!s){this.invalidate();return t}i.removeChild(s.parentElement);return t};A.prototype.onBeforeRendering=function(){this._detectActiveLayout();var e=this._resizeListeners[this.getId()];if(e){f.deregister(e)}m.getInstance();this._isRenderingFinished=false;this._lastGridWidth=null;this._lastViewportWidth=null};A.prototype.onAfterRendering=function(){this._resizeListeners[this.getId()]=f.register(this.getDomRef(),this._resizeHandler);this._isRenderingFinished=true;this._setItemNavigationItems();this._applyLayout(true);if(this.getItems().length===1&&this._forceFocus){this.focusItem(0);this._forceFocus=false}};A.prototype.exit=function(){this._deregisterResizeListeners();if(this._itemsObserver){this._itemsObserver.disconnect();delete this._itemsObserver}if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation;this._oItemNavigation=null}this._forceFocus=null;if(this._checkColumnsTimeout){clearTimeout(this._checkColumnsTimeout);this._checkColumnsTimeout=null}y.detachApplied(this._handleThemeAppliedBound)};A.prototype._initRangeSet=function(){if(!_.media.hasRangeSet("GridContainerRangeSet")){_.media.initRangeSet("GridContainerRangeSet",[375,600,1024,1440],"px",["XS","S","M","L","XL"])}};A.prototype._resize=function(){if(!this._isWidthChanged()){return}var e=this._detectActiveLayout();this._applyLayout(e)};A.prototype._resizeDevice=function(){if(!this.getContainerQuery()){this._resize()}};A.prototype._isWidthChanged=function(){var e=this._getComputedWidth(),t=_.resize.width;if(this._lastGridWidth===e&&this._lastViewportWidth===t){return false}this._lastGridWidth=e;this._lastViewportWidth=t;return true};A.prototype._getComputedWidth=function(){if(!this.getDomRef()){return null}return this.getDomRef().getBoundingClientRect().width};A.prototype._resizeItem=function(e){this._applyItemAutoRows(e.control)};A.prototype._applyLayout=function(e){if(!this._isRenderingFinished){return}if(e){this.$("listUl").css(this._getActiveGridStyles());this.getItems().forEach(this._applyItemAutoRows.bind(this))}this._checkColumns()};A.prototype._checkColumns=function(){if(this._checkColumnsTimeout){clearTimeout(this._checkColumnsTimeout);this._checkColumnsTimeout=null}this._checkColumnsTimeout=setTimeout(function(){this._detectColumnsChange();this._enforceMaxColumns()}.bind(this),0)};A.prototype._applyItemAutoRows=function(e){if(!this._isRenderingFinished){return}if(this.getInlineBlockLayout()){return}if(b(e)){var t=e.$(),i=this.getActiveLayoutSettings(),s=e.getDomRef()?e.getDomRef().getBoundingClientRect().height:0,r=i.calculateRowsForItem(Math.round(s));if(!r){return}t.parent().css({"grid-row":"span "+Math.max(r,R(e))})}};A.prototype._enforceMaxColumns=function(){var e=this.getActiveLayoutSettings(),t;if(!e){return}t=e.getComputedColumnsCount(this.$("listUl").innerWidth());if(!t){return}this.getItems().forEach(function(e){e.$().parent().css("grid-column","span "+Math.min(I(e),t))})};A.prototype._createItemWrapper=function(t){var i=e.getStylesForItemWrapper(t,this),s=i.styles,r=i.classes,n=document.createElement("div");n.setAttribute("id",e.generateWrapperId(t,this));n.setAttribute("tabindex","0");s.forEach(function(e,t){n.style.setProperty(t,e)});r.forEach(function(e){n.classList.add(e)});return n};A.prototype.onItemNavigationBorderReached=function(e){this.fireEvent("borderReached",e)};["onkeypress","onkeyup","onkeydown","onsapenter","onsapselect","onsapspace"].forEach(function(e){A.prototype[e]=function(t){if(!this._isItemWrapper(t.target)){return}if(e==="onsapspace"){t.preventDefault()}var i=c.closestTo(t.target.firstChild);if(i){var s=i.getFocusDomRef(),r=c.closestTo(s);if(r&&r[e]){r[e].call(r,t)}}}});A.prototype._checkOwnVisualFocus=function(e){var t=e.getMetadata().getName(),s;if(C[t]&&C[t](e)){s=e.getFocusDomRef();if(s.getAttribute("tabindex")==="0"){s.setAttribute("tabindex",-1);s.tabIndex=-1}i.getItemWrapper(e).classList.add("sapFGridContainerItemWrapperNoVisualFocus")}};A.prototype._moveItem=function(e){if(!e.ctrlKey){return}if(!this._isItemWrapper(e.target)){return}var t=c.closestTo(e.target.firstElementChild),s=this.getItems().length,r=this.indexOfItem(t),n=-1,u,l=[];switch(e.keyCode){case v.ARROW_RIGHT:n=o.getRTL()?r-1:r+1;if(n>=0&&n<s){u=i.createConfig(this,this.getItems()[n]);u.dropPosition="After";l=[u]}break;case v.ARROW_LEFT:n=o.getRTL()?r+1:r-1;if(n>=0&&n<s){u=i.createConfig(this,this.getItems()[n]);u.dropPosition="Before";l=[u]}break;case v.ARROW_UP:l=i.findDropTargetsAbove(this,t);l.forEach(function(e){e.dropPosition="Before"});break;case v.ARROW_DOWN:l=i.findDropTargetsBelow(this,t);l.forEach(function(e){e.dropPosition=this.indexOfItem(e.item)!==-1?"After":"Before"}.bind(this));break;default:break}e.stopPropagation();a.fireDnD(t,l,e);this._setItemNavigationItems()};A.prototype.onsapincreasemodifiers=A.prototype._moveItem;A.prototype.onsapdecreasemodifiers=A.prototype._moveItem;A.prototype.focusItem=function(e){var t,i=this._oItemNavigation;this._forceFocus=true;this._setItemNavigationItems();t=i.getItemDomRefs();if(t[e]){i.focusItem(e)}};A.prototype.focusItemByDirection=function(e,t,i){this._oItemNavigation.focusItemByDirection(this,e,t,i)};A.prototype.getNavigationMatrix=function(){if(!this._bThemeApplied){return null}var e=this.getItems().reduce(function(e,t){if(t.getVisible()){e.push(i.getItemWrapper(t))}return e},[]);return s.create(this.getDomRef("listUl"),e)};A.prototype._isItemWrapper=function(e){return e.classList.contains("sapFGridContainerItemWrapper")};A.prototype._handleThemeApplied=function(){this._bThemeApplied=true;y.detachApplied(this._handleThemeAppliedBound)};return A});
//# sourceMappingURL=GridContainer.js.map